<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>CFSS: Computing for the Social Sciences</title><meta name=description content='<!DOCTYPE html> Text analysis: topic modeling and sentiment analysis class: center, middle, inverse, title-slide .title[ # Text analysis: topic modeling and sentiment analysis ] .author[ ### MACSS 30500 University of Chicago ] --- # Agenda * Topic Modeling * LDA * Sentiment Analysis * Positive / negative sentiment * Application: TS! * Future applications: * Author prediction --- class: inverse, middle # Topic Modeling --- # Topic Modeling Method to organize and understand large collections of textual information (without reading them). How? -- By **finding groups of words ("topics") that go together.** Words that co-occur more frequently that chance alone would predict are assigned to the same topic. Example: organizing 1.2M books into 2000 topics see David Mimno [slides here](https://mimno.infosci.cornell.edu/slides/details.pdf) and [video here](https://vimeo.com/53080123). --- # Topic Modeling **Word Frequency** looks at the exact recurrence of each word in a corpus (using a simple count or a weighted count). Instead: **Topic Modeling** looks at how groups of words co-occur together (using probability). -- Intuition: The meaning of words is dependent upon the broader context in which they are used. --- # Topic Modeling A topic is a set of words that are associated with one another, showing an underlying common theme that is semantically interpretable by humans. A topic is similar to what a human would call a theme or a discourse: whenever a specific discourse is made, some words tend to come up more frequently than others. The goal of TM is to identify the discourses that characterize a collection of documents. --- # Topic Modeling One way to think about how TM… Imagine working through an article with a set of highlighters. As you read through the article: * you use a different color for the key words of themes within the article as you encounter them * when you were done, you could take all words of the same color and create separate lists (one per each topic) --- # Topic Modeling <img src="tm.png" width="90%" style="display: block; margin: auto;" /> --- # Topic Modeling: LDA TM is the name of a family of algorithms. The most common is **LDA or Latent Dirichlet Allocation**. This model assumes that: 1. every document in a corpus contains a mixture of topics that are found throughout the entire corpus 1. each topic is made of a (limited) mixture of characteristic words, which tend to occur together whenever the topic is displayed The topic structure is hidden ("latent"): we can only observe the documents and words, not the topics themselves; the goal is to infer such topics by the words and documents (more formally: topic modeling computes the conditional posterior distribution of latent variables, e.g. topics, given the observed variables, e.g. words in documents). --- # Topic Modeling: LDA **LDA works as follows:** 1. The researcher begins by setting an arbitrary number of topics (`k`) for the whole collection of documents. 1. The algorithm (Gibbs sampling) creates, simultaneously: * a first randomly chosen word-topic probability: distribution of topics over all observed words in the collection * a first randomly chosen document-topic probability: distribution of topics by document 1. Through reiterative attempts, the algorithm adjusts these initial distributions to provide a set of probabilities for every word-topic pair and for every document-topic pair. --- # Topic Modeling: LDA **LDA produces two types of output:** 1. words most frequently associated with each of the `k` topics specified by the researcher 1. documents most frequently associated with each of the `k` topics (the researcher defines a probability threshold) --- # Topic Modeling: LDA simple example We start with a simple example, then move to a real example in R. Imagine we have a corpus with the following five documents (each document is one sentence): **Document 1** I ate a banana and spinach smoothie for breakfast. **Document 2** I like to eat broccoli and bananas. **Document 3** Puppies and kittens are cute. **Document 4** My sister adopted a kitten yesterday. **Document 5** This cute hamster is eating a piece of broccoli. --- # Topic Modeling: LDA simple example **First, we need to transform these textual data in the appropriate form needed for LDA:** * input: * raw data * output: * create a vocabulary (remove stop words, lowercase, tokenize, etc.) * create a document-term matrix **Then, we run LDA:** * input: * the document-term matrix as input * the number of topics we want to generate (we decide them) * output: * the word-topic and document-topic probabilities --- # Topic Modeling: LDA simple example If we give to LDA the document-term matrix from these 5 documents, and we ask for 2 topics, LDA might produce something like: **Topic A:** 30% eat, 20% broccoli, 15% bananas, 10% breakfast, … **Topic B:** 20% dog, 20% kitten, 20% cute, 15% hamster, … -- **Document 1 and 2** 100% Topic A (we can label it "food") **Document 3 and 4**: 100% Topic B (we can label it "cute animals") **Document 5:** 60% Topic A, 40% Topic B --- # Topic Modeling: LDA example in R Download today&#39;s class materials to access the code. (`usethis::use_course("CFSS-MACSS/text-analysis-fundamentals-and-sentiment-analysis-and-tm")`) We have additional resources you can practice with as well! **Examples from the book**: Chapter 6, and the three case-study chapters + Chapter 2 to reshape the data into the appropriate format for LDA --- class: inverse, middle, center ![](https://media.giphy.com/media/tNTq5fw9apN2OzZID9/giphy.gif) --- # A thorough examination of Taylor Swift Lyrics -- Recall the following graphic: ![visualization of textual analysis process](https://www.tidytextmining.com/images/tmwr_0101.png) -- We will move through this process using [this dataset of Taylor Swift albums and lyrics from Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums?resource=download) --- ## Basic workflow for text analysis We can think at the basic workflow as a 4-step process: 1. Obtain your textual data: **Kaggle, check!** 1. Data cleaning and pre-processing **OOF THIS WAS A PAIN** *see end of slides for more detail* 1. Data transformation **building on last class&#39;s materials** 1. Perform analysis **the fun part** --- # Steps: Data cleaning and pre-processing (see: data/swift_data_raw) To find the data, I googled things like, &#39;taylor swift lyrics dataset&#39; before finding the dataset on kaggle. I then spot-checked some of the albums and songs to be sure that things looked generally OK. (remember, once you use someone else&#39;s data, it becomes your problem!) I pulled all this in and tried to use specific code and packages that we&#39;ve used in class as much as possible so you could see where the pieces came from. Without belaboring this too much, you can see in today&#39;s files where I have the raw data I imported and cleaned, and how I timmed out unwanted characteristics / elements, e.g. [Chorus]. --- # Steps: Data cleaning and pre-processing (see: data/swift_data_raw) Here is a snippet of what the raw structure was: `data > albums > 1989 > song.txt` -- Here is what the raw txt file looked like: ```r strwrap(read_lines(here("..", "text-analysis-fundamentals-and-sentiment-analysis-and-tm", "data", "swift_data_raw", "Albums", "1989", "BlankSpace.txt")), 80) ## [1] "237 ContributorsTranslationsTürkçeEspañolPortuguêsPolskiΕλληνικάFrançaisBlank" ## [2] "Space Lyrics[Verse 1]" ## [3] "Nice to meet you, where you been?" ## [4] "I could show you incredible things" ## [5] "Magic, madness, heaven, sin" ## [6] "Saw you there and I thought" ## [7] "\"Oh, my God, look at that face" ## [8] "You look like my next mistake" ## [9] "Love&#39;s a game, wanna play?\" Ayy" ## [10] "New money, suit and tie" ## [11] "I can read you like a magazine" ## [12] "Ain&#39;t it funny? Rumors fly" ## [13] "And I know you heard about me" ## [14] "So, hey, let&#39;s be friends" ## [15] "I&#39;m dying to see how this one ends" ## [16] "Grab your passport and my hand" ## [17] "I can make the bad guys good for a weekend" ## [18] "[Chorus]" ## [19] "So, it&#39;s gonna be forever" ## [20] "Or it&#39;s gonna go down in flames?" ## [21] "You can tell me when it&#39;s over, mm" ## [22] "If the high was worth the pain" ## [23] "Got a long list of ex-lovers" ## [24] "They&#39;ll tell you I&#39;m insane" ## [25] "&#39;Cause you know I love the players" ## [26] "And you love the game" ## [27] "&#39;Cause we&#39;re young and we&#39;re reckless" ## [28] "We&#39;ll take this way too far" ## [29] "It&#39;ll leave you breathless, mm" ## [30] "Or with a nasty scar" ## [31] "Got a long list of ex-lovers" ## [32] "They&#39;ll tell you I&#39;m insane" ## [33] "But I&#39;ve got a blank space, baby" ## [34] "And I&#39;ll write your name" ## [35] "" ## [36] "[Verse 2]" ## [37] "Cherry lips, crystal skies" ## [38] "I could show you incredible things" ## [39] "Stolen kisses, pretty lies" ## [40] "You&#39;re the king, baby, I&#39;m your queen" ## [41] "Find out what you want" ## [42] "Be that girl for a month" ## [43] "Wait, the worst is yet to come, oh, no" ## [44] "Screaming, crying, perfect storms" ## [45] "I can make all the tables turn" ## [46] "Rose garden filled with thorns" ## [47] "Keep you second guessing, like" ## [48] "\"Oh, my God, who is she?\"" ## [49] "I get drunk on jealousy" ## [50] "But you&#39;ll come back each time you leave" ## [51] "&#39;Cause, darling, I&#39;m a nightmare dressed like a daydream" ## [52] "You might also like[Chorus]" ## [53] "So, it&#39;s gonna be forever" ## [54] "Or it&#39;s gonna go down in flames?" ## [55] "You can tell me when it&#39;s over, mm" ## [56] "If the high was worth the pain" ## [57] "Got a long list of ex-lovers" ## [58] "They&#39;ll tell you I&#39;m insane" ## [59] "&#39;Cause you know I love the players" ## [60] "And you love the game" ## [61] "&#39;Cause we&#39;re young and we&#39;re reckless (Oh)" ## [62] "We&#39;ll take this way too far" ## [63] "It&#39;ll leave you breathless (Oh-oh), mm" ## [64] "Or with a nasty scar" ## [65] "Got a long list of ex-lovers" ## [66] "They&#39;ll tell you I&#39;m insane (Insane)" ## [67] "But I&#39;ve got a blank space, baby" ## [68] "And I&#39;ll write your name" ## [69] "" ## [70] "[Bridge]" ## [71] "Boys only want love if it&#39;s torture" ## [72] "Don&#39;t say I didn&#39;t, say I didn&#39;t warn ya" ## [73] "Boys only want love if it&#39;s torture" ## [74] "Don&#39;t say I didn&#39;t, say I didn&#39;t warn ya" ## [75] "" ## [76] "[Chorus]" ## [77] "So, it&#39;s gonna be forever" ## [78] "Or it&#39;s gonna go down in flames?" ## [79] "You can tell me when it&#39;s over (Over), mm" ## [80] "If the high was worth the pain" ## [81] "Got a long list of ex-lovers" ## [82] "They&#39;ll tell you I&#39;m insane (I&#39;m insane)" ## [83] "&#39;Cause you know I love the players" ## [84] "And you love the game (And you love the game)" ## [85] "&#39;Cause we&#39;re young and we&#39;re reckless (Yeah)" ## [86] "We&#39;ll take this way too far (Ooh)" ## [87] "It&#39;ll leave you breathless, mm" ## [88] "Or with a nasty scar (With a nasty scar)" ## [89] "Got a long list of ex-lovers" ## [90] "They&#39;ll tell you I&#39;m insane" ## [91] "But I&#39;ve got a blank space, baby" ## [92] "And I&#39;ll write your name1KEmbed" ``` --- # Steps: Cleaning (see: data/swift_data_raw) Obviously, there&#39;s a lot of work that was needed here. I did a rough clean -- for publication, I would probably do another pass or two and do some more spot checks. (I like to use a random number generator to select a row of my dataframe to verify that everything is good / looks OK). -- **Steps**: 1. Generate list of file paths (note I had to loop through albums to get songs). (HW05 was helpful for this) 1. Extract album title * Get title from path string * Add spaces back in where needed 1. Extract song title from file path * Get title from path string * Add spaces back in where needed 1. Read in data: * Read lines from path * Remove the top line * Get rid of any chunks about song structure 1. Merge data (Album, Song, Lyrics) and export as data frame --- # Steps: Data transformation * Remove stop words (sort of interesting, what do you do about songs like, &#39;the 1&#39;?). * Perform analysis on entire corpus and by album: * Frequency of words (histogram and wordcloud) * Sentiment of words (positive / negative) * Emotional score for text and albums * Consider future steps: "eras" and "eras tour"??? --- # Steps: Perform analysis on entire corpus vs albums For this, we want to explore the most common words used by Taylor Swift overall. We can then consider how we might want to break things out in future anlaysis. *(Note, this was a rough clean, so we have some words that don&#39;t fully make sense in here).* -- .panelset[ .panel[.panel-name[Overall Analysis] <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words.png" alt="Histogram of most frequent words in Taylor Swift songs" width="30%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs</p> </div> ] .panel[.panel-name[Wordcloud] <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud.png" alt="Wordcloud of most frequent tokens in Taylor Swift songs" width="40%" /> <p class="caption">Wordcloud of most frequent tokens in Taylor Swift songs</p> </div> ] .panel[.panel-name[Wordcloud: Pos/Neg] <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud_pos_neg.png" alt="Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics" width="40%" /> <p class="caption">Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics</p> </div> ] .panel[.panel-name[Analysis by Album] <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="50%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> ] ] --- # Steps: Visualizations (Wordcloud) Here, we can explore the word cloud generated from the text. THESE ARE NOT FOR ANALYSIS. YES THEY ARE COOL. NO THEY ARE NOT ANALYSIS!!! -- <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud.png" alt="Word cloud of popular tokens" width="40%" /> <p class="caption">Word cloud of popular tokens</p> </div> --- ## Trajectory: Thinking about word use <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from &#39;girl&#39; in her early albums to &#39;woman&#39; in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. --- ## Trajectory: Thinking about word use (tf-idf) When calculating tf-idf, we&#39;re looking for words that are more common relative to the rest of the corpus. We can think of this as an &#39;album signature&#39; in our case. Here, we can see that we get a collection of different words than when we just look at the most frequent words. <div class="figure" style="text-align: center"> <img src="../../img/ts_idf_words.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from &#39;girl&#39; in her early albums to &#39;woman&#39; in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. --- # (reminder / review) LDA: TOPICS LDA (Laten Dirichlet Allocation) is one method for fitting a topic model. It offers a means of *unsupervised* classification of a collection of documents. (I think of it as you dump a bunch of items into a pile and it sorts them for you based on patterns it finds...although the same item could appear in multiple piles). Small / simple example: suppose you have a list of a bunch of animals that you want grouped. You give it the following: dog, cat, parakeet, tiger, polar bear, lion, penguin. If you tell the model you want three topics, it might provide the following groups: * Topic 1: Dog, cat, parakeet * Topic 2: Parakeet, penguin, polar bear * Topic 3: Cat, tiger, lion -- It&#39;s up to you, the researcher, to determine what meaning or value lies within these topics / allocations. You may also determine how many topics you would like (more topics can mean a slower model). If you had said two topics, you might have gotten the following instead: * Topic 1: Dog, cat, parakeet * Topic 2: Penguin, polar bear, tiger, lion Notice that the &#39;sense&#39; you make of the topics might be different in the two situations. --- # LDA: Two topic model Let&#39;s start with a simple two-topic model (we&#39;ll get more complicated soon!) <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_topics.png" alt="Frequent words in a two-topic model" width="50%" /> <p class="caption">Frequent words in a two-topic model</p> </div> -- We can think about what we might &#39;call&#39; these topics and how we might want to explore this further. (Again, note this is unsupervised!) --- # LDA: understanding the right number of topics Let&#39;s try that again, but now with different numbers of topics. I have a visualization that is a little different from the text because I felt like it helped visualize the results better. We could do boxplots, but those were a bit messy for this particular dataset. -- .panelset[ .panel[.panel-name[Two topics] <div class="figure" style="text-align: center"> <img src="../../img/ts_2topics.png" alt="Text plot of songs, colored by albums (two topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (two topics)</p> </div> ] .panel[.panel-name[Three topics] <div class="figure" style="text-align: center"> <img src="../../img/ts_3topics.png" alt="Text plot of songs, colored by albums (three topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (three topics)</p> </div> ] .panel[.panel-name[Ten topics!] <div class="figure" style="text-align: center"> <img src="../../img/ts_10topics.png" alt="Text plot of songs, colored by albums (ten topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (ten topics)</p> </div> ] ] --- # Reflection: I think two topics makes sense here, of our options. However, I would be interested in pooling albums and reassessing to see. Alternatively, we might want to think about other ways to explore the meaning / distinctions. --- # Topic modeling: pros/cons * Topic models **account for "multiplexity":** a given document is unlikely to fall precisely and fully into a single topic * Topic models **do not care about the order of words** “dog eats food" is the same as "food eats dog" * To determine the "right" number of topics: no fixed rule, it is a try-error process, ultimately **the researcher decides** (there are some metrics, such as perplexity and coherence score but are beyond our goals) * Topics are **unlabeled:** they are just a bunch of words, it is up to the researcher to read, interpret, and label them * Topic models are **no substitute for human interpretation of a text:** they are a way of making educated guesses about how words cohere into different latent themes by identifying patterns in the way they co-occur within documents. Many people are somewhat disappointed when they discover their model produces uninformative results --- # LDAvis LDAvis is a an interactive visualization of LDA model results https://github.com/cpsievert/LDAvis 1. What is the meaning of each topic? 1. How prevalent is each topic? 1. How do the topics relate to each other? --- class: inverse, middle # Sentiment Analysis --- # Sentiment Analysis Use of NLP and programming to **study emotional states and subjective information in a text**. In practice sentiment analysis is usually applied: * to determine the polarity of a text: whether a text is positive, negative, or neutral * to detect specific feelings and emotions: angry, sad, happy, etc. * examples: analyzing costumer feedback, classify movies review Different from Topic Modeling, Sentiment Analysis it is usually supervised (e.g., needs a labeled input to compare our text to) --- # Sentiment Analysis: our approach Our approach to sentiment analysis (consistent with the book, Chapter 2): * consider the text a combination of its individual words, and * consider the sentiment content of the text as the sum of the sentiment content of the individual words Notice: "This isn’t the only way to approach sentiment analysis, but it is an often-used approach, and an approach that naturally takes advantage of the tidy tool ecosystem." --- # The `sentiments` datasets The tidytext package provides access to several sentiment lexicons: + **AFINN** from Finn Årup Nielsen (words classified with on a scale from -5 to +5) + **bing** from Bing Liu and collaborators (words classified into binary categories: negative and positive) + **nrc** from Saif Mohammad and Peter Turney (words classified in multiple categories) See: https://www.tidytextmining.com/sentiment.html#the-sentiments-datasets --- # The `sentiments` datasets These dictionaries constitute our gold standard (e.g., our labeled sentiments): we use them to classify our texts. Dictionary-based methods like these find the total sentiment of a piece of text by adding up the individual sentiment scores for each word in the text. --- # Sentiment Analysis: Examples **Examples from the book**: Chapter 2, and the three case-study chapters **Another example (in today&#39;s class-materials)**: sentiment analysis of Harry Potter textual data. **Another example (in today&#39;s class-materials)**: sentiment analysis of Taylor Swift albums --- class: middle, inverse, center # Back to TS ![](https://media.giphy.com/media/u23zXEvNsIbfO/giphy.gif) --- # Steps: Analysis -- Sentiment Here, we can look at the sentiment within her work: specifically, what are the positive and negative words used, both overall and by album? -- .panelset[ .panel[.panel-name[Overall Analysis] <div class="figure" style="text-align: center"> <img src="../../img/ts_sentiment.png" alt="Histogram of positive and negative sentiment in Taylor Swift songs" width="40%" /> <p class="caption">Histogram of positive and negative sentiment in Taylor Swift songs</p> </div> ] .panel[.panel-name[Analysis by Album: Positive] <div class="figure" style="text-align: center"> <img src="../../img/ts_positive_words_album.png" alt="Histogram of positive sentiment in Taylor Swift songs by album" width="40%" /> <p class="caption">Histogram of positive sentiment in Taylor Swift songs by album</p> </div> ] .panel[.panel-name[Analysis by Album: Negative] <div class="figure" style="text-align: center"> <img src="../../img/ts_negative_words_album.png" alt="Histogram of negative sentiment in Taylor Swift songs by album" width="40%" /> <p class="caption">Histogram of negative sentiment in Taylor Swift songs by album</p> </div> ] ] --- # Steps: Analysis (Negative Sentiment) Again, here some expertise / background on Taylor Swift can be helpful to make sense of our analysis. We can see that her early work has less &#39;intense&#39; (generally) language and the negative sentiment features words like, &#39;crazy,&#39; &#39;sad,&#39; and &#39;bad&#39;. With Reputation, we see a shift (this makes sense given the album and its role in her discography). Here, we see words like &#39;hate&#39; come in and, as we move into more recent albums, words like &#39;death,&#39; &#39;shit,&#39; &#39;kill.&#39; <div class="figure" style="text-align: center"> <img src="../../img/ts_negative_words_album.png" alt="Histogram of negative words by album" width="45%" /> <p class="caption">Histogram of negative words by album</p> </div> # Steps: Analysis (Negative Sentiment) With positive words, we see a lot of consistency (&#39;like&#39;) and while there are some more &#39;innocent&#39; words appearing with more frequency in earlier albums, we don&#39;t see as much change / evolution as we did with the negative words. If anything, the language has gotten more direct in the later work (which, particularly thinking about 1989 and Midnights, makes sense). -- <div class="figure" style="text-align: center"> <img src="../../img/ts_positive_words_album.png" alt="Histogram of postive words used by album" width="45%" /> <p class="caption">Histogram of postive words used by album</p> </div> --- # Steps: Visualizations -- <div class="figure" style="text-align: center"> <img src="../../img/ts_sentiment_album.png" alt="Emotional arc of TS albums" width="40%" /> <p class="caption">Emotional arc of TS albums</p> </div> --- class: inverse, middle, center ![](https://media.giphy.com/media/ej1WNA2G75DfUai7NR/giphy.gif) --- # Recap: * There are methods for analyzing text and getting a sense of the common ideas and topics that emerge * Unsupervised (easier), supervised (need training data of some kind) can provide techniques to offer deeper insights * Sentiment analysis looks at overall valence of words * Lots of room for researcher to interpret: can be difficult to do well and needs some expertise to evaluate. --- # Acknowledgements The content of these slides is derived in part from Sabrina Nardin and Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. I developed the Taylor Swift example using data from [Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums/versions/12?resource=download) and building on code from [Text Mining in R](https://www.tidytextmining.com/). Any errors or oversights are mine alone. --- class: middle, center, inverse # THANK YOU ALL FOR A GREAT CLASS! I have genuinely enjoyed getting to know you and your work and hope you keep in touch regarding how you use R in the future! We have one assignment remaining. Have a great rest of your summer!'><meta property="og:url" content="https://cfssmacss.netlify.app/slides/text-analysis-classification-and-topic-modeling/"><meta property="og:site_name" content="CFSS: Computing for the Social Sciences"><meta property="og:title" content="CFSS: Computing for the Social Sciences"><meta property="og:description" content='<!DOCTYPE html> Text analysis: topic modeling and sentiment analysis class: center, middle, inverse, title-slide .title[ # Text analysis: topic modeling and sentiment analysis ] .author[ ### MACSS 30500 University of Chicago ] --- # Agenda * Topic Modeling * LDA * Sentiment Analysis * Positive / negative sentiment * Application: TS! * Future applications: * Author prediction --- class: inverse, middle # Topic Modeling --- # Topic Modeling Method to organize and understand large collections of textual information (without reading them). How? -- By **finding groups of words ("topics") that go together.** Words that co-occur more frequently that chance alone would predict are assigned to the same topic. Example: organizing 1.2M books into 2000 topics see David Mimno [slides here](https://mimno.infosci.cornell.edu/slides/details.pdf) and [video here](https://vimeo.com/53080123). --- # Topic Modeling **Word Frequency** looks at the exact recurrence of each word in a corpus (using a simple count or a weighted count). Instead: **Topic Modeling** looks at how groups of words co-occur together (using probability). -- Intuition: The meaning of words is dependent upon the broader context in which they are used. --- # Topic Modeling A topic is a set of words that are associated with one another, showing an underlying common theme that is semantically interpretable by humans. A topic is similar to what a human would call a theme or a discourse: whenever a specific discourse is made, some words tend to come up more frequently than others. The goal of TM is to identify the discourses that characterize a collection of documents. --- # Topic Modeling One way to think about how TM… Imagine working through an article with a set of highlighters. As you read through the article: * you use a different color for the key words of themes within the article as you encounter them * when you were done, you could take all words of the same color and create separate lists (one per each topic) --- # Topic Modeling <img src="tm.png" width="90%" style="display: block; margin: auto;" /> --- # Topic Modeling: LDA TM is the name of a family of algorithms. The most common is **LDA or Latent Dirichlet Allocation**. This model assumes that: 1. every document in a corpus contains a mixture of topics that are found throughout the entire corpus 1. each topic is made of a (limited) mixture of characteristic words, which tend to occur together whenever the topic is displayed The topic structure is hidden ("latent"): we can only observe the documents and words, not the topics themselves; the goal is to infer such topics by the words and documents (more formally: topic modeling computes the conditional posterior distribution of latent variables, e.g. topics, given the observed variables, e.g. words in documents). --- # Topic Modeling: LDA **LDA works as follows:** 1. The researcher begins by setting an arbitrary number of topics (`k`) for the whole collection of documents. 1. The algorithm (Gibbs sampling) creates, simultaneously: * a first randomly chosen word-topic probability: distribution of topics over all observed words in the collection * a first randomly chosen document-topic probability: distribution of topics by document 1. Through reiterative attempts, the algorithm adjusts these initial distributions to provide a set of probabilities for every word-topic pair and for every document-topic pair. --- # Topic Modeling: LDA **LDA produces two types of output:** 1. words most frequently associated with each of the `k` topics specified by the researcher 1. documents most frequently associated with each of the `k` topics (the researcher defines a probability threshold) --- # Topic Modeling: LDA simple example We start with a simple example, then move to a real example in R. Imagine we have a corpus with the following five documents (each document is one sentence): **Document 1** I ate a banana and spinach smoothie for breakfast. **Document 2** I like to eat broccoli and bananas. **Document 3** Puppies and kittens are cute. **Document 4** My sister adopted a kitten yesterday. **Document 5** This cute hamster is eating a piece of broccoli. --- # Topic Modeling: LDA simple example **First, we need to transform these textual data in the appropriate form needed for LDA:** * input: * raw data * output: * create a vocabulary (remove stop words, lowercase, tokenize, etc.) * create a document-term matrix **Then, we run LDA:** * input: * the document-term matrix as input * the number of topics we want to generate (we decide them) * output: * the word-topic and document-topic probabilities --- # Topic Modeling: LDA simple example If we give to LDA the document-term matrix from these 5 documents, and we ask for 2 topics, LDA might produce something like: **Topic A:** 30% eat, 20% broccoli, 15% bananas, 10% breakfast, … **Topic B:** 20% dog, 20% kitten, 20% cute, 15% hamster, … -- **Document 1 and 2** 100% Topic A (we can label it "food") **Document 3 and 4**: 100% Topic B (we can label it "cute animals") **Document 5:** 60% Topic A, 40% Topic B --- # Topic Modeling: LDA example in R Download today&#39;s class materials to access the code. (`usethis::use_course("CFSS-MACSS/text-analysis-fundamentals-and-sentiment-analysis-and-tm")`) We have additional resources you can practice with as well! **Examples from the book**: Chapter 6, and the three case-study chapters + Chapter 2 to reshape the data into the appropriate format for LDA --- class: inverse, middle, center ![](https://media.giphy.com/media/tNTq5fw9apN2OzZID9/giphy.gif) --- # A thorough examination of Taylor Swift Lyrics -- Recall the following graphic: ![visualization of textual analysis process](https://www.tidytextmining.com/images/tmwr_0101.png) -- We will move through this process using [this dataset of Taylor Swift albums and lyrics from Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums?resource=download) --- ## Basic workflow for text analysis We can think at the basic workflow as a 4-step process: 1. Obtain your textual data: **Kaggle, check!** 1. Data cleaning and pre-processing **OOF THIS WAS A PAIN** *see end of slides for more detail* 1. Data transformation **building on last class&#39;s materials** 1. Perform analysis **the fun part** --- # Steps: Data cleaning and pre-processing (see: data/swift_data_raw) To find the data, I googled things like, &#39;taylor swift lyrics dataset&#39; before finding the dataset on kaggle. I then spot-checked some of the albums and songs to be sure that things looked generally OK. (remember, once you use someone else&#39;s data, it becomes your problem!) I pulled all this in and tried to use specific code and packages that we&#39;ve used in class as much as possible so you could see where the pieces came from. Without belaboring this too much, you can see in today&#39;s files where I have the raw data I imported and cleaned, and how I timmed out unwanted characteristics / elements, e.g. [Chorus]. --- # Steps: Data cleaning and pre-processing (see: data/swift_data_raw) Here is a snippet of what the raw structure was: `data > albums > 1989 > song.txt` -- Here is what the raw txt file looked like: ```r strwrap(read_lines(here("..", "text-analysis-fundamentals-and-sentiment-analysis-and-tm", "data", "swift_data_raw", "Albums", "1989", "BlankSpace.txt")), 80) ## [1] "237 ContributorsTranslationsTürkçeEspañolPortuguêsPolskiΕλληνικάFrançaisBlank" ## [2] "Space Lyrics[Verse 1]" ## [3] "Nice to meet you, where you been?" ## [4] "I could show you incredible things" ## [5] "Magic, madness, heaven, sin" ## [6] "Saw you there and I thought" ## [7] "\"Oh, my God, look at that face" ## [8] "You look like my next mistake" ## [9] "Love&#39;s a game, wanna play?\" Ayy" ## [10] "New money, suit and tie" ## [11] "I can read you like a magazine" ## [12] "Ain&#39;t it funny? Rumors fly" ## [13] "And I know you heard about me" ## [14] "So, hey, let&#39;s be friends" ## [15] "I&#39;m dying to see how this one ends" ## [16] "Grab your passport and my hand" ## [17] "I can make the bad guys good for a weekend" ## [18] "[Chorus]" ## [19] "So, it&#39;s gonna be forever" ## [20] "Or it&#39;s gonna go down in flames?" ## [21] "You can tell me when it&#39;s over, mm" ## [22] "If the high was worth the pain" ## [23] "Got a long list of ex-lovers" ## [24] "They&#39;ll tell you I&#39;m insane" ## [25] "&#39;Cause you know I love the players" ## [26] "And you love the game" ## [27] "&#39;Cause we&#39;re young and we&#39;re reckless" ## [28] "We&#39;ll take this way too far" ## [29] "It&#39;ll leave you breathless, mm" ## [30] "Or with a nasty scar" ## [31] "Got a long list of ex-lovers" ## [32] "They&#39;ll tell you I&#39;m insane" ## [33] "But I&#39;ve got a blank space, baby" ## [34] "And I&#39;ll write your name" ## [35] "" ## [36] "[Verse 2]" ## [37] "Cherry lips, crystal skies" ## [38] "I could show you incredible things" ## [39] "Stolen kisses, pretty lies" ## [40] "You&#39;re the king, baby, I&#39;m your queen" ## [41] "Find out what you want" ## [42] "Be that girl for a month" ## [43] "Wait, the worst is yet to come, oh, no" ## [44] "Screaming, crying, perfect storms" ## [45] "I can make all the tables turn" ## [46] "Rose garden filled with thorns" ## [47] "Keep you second guessing, like" ## [48] "\"Oh, my God, who is she?\"" ## [49] "I get drunk on jealousy" ## [50] "But you&#39;ll come back each time you leave" ## [51] "&#39;Cause, darling, I&#39;m a nightmare dressed like a daydream" ## [52] "You might also like[Chorus]" ## [53] "So, it&#39;s gonna be forever" ## [54] "Or it&#39;s gonna go down in flames?" ## [55] "You can tell me when it&#39;s over, mm" ## [56] "If the high was worth the pain" ## [57] "Got a long list of ex-lovers" ## [58] "They&#39;ll tell you I&#39;m insane" ## [59] "&#39;Cause you know I love the players" ## [60] "And you love the game" ## [61] "&#39;Cause we&#39;re young and we&#39;re reckless (Oh)" ## [62] "We&#39;ll take this way too far" ## [63] "It&#39;ll leave you breathless (Oh-oh), mm" ## [64] "Or with a nasty scar" ## [65] "Got a long list of ex-lovers" ## [66] "They&#39;ll tell you I&#39;m insane (Insane)" ## [67] "But I&#39;ve got a blank space, baby" ## [68] "And I&#39;ll write your name" ## [69] "" ## [70] "[Bridge]" ## [71] "Boys only want love if it&#39;s torture" ## [72] "Don&#39;t say I didn&#39;t, say I didn&#39;t warn ya" ## [73] "Boys only want love if it&#39;s torture" ## [74] "Don&#39;t say I didn&#39;t, say I didn&#39;t warn ya" ## [75] "" ## [76] "[Chorus]" ## [77] "So, it&#39;s gonna be forever" ## [78] "Or it&#39;s gonna go down in flames?" ## [79] "You can tell me when it&#39;s over (Over), mm" ## [80] "If the high was worth the pain" ## [81] "Got a long list of ex-lovers" ## [82] "They&#39;ll tell you I&#39;m insane (I&#39;m insane)" ## [83] "&#39;Cause you know I love the players" ## [84] "And you love the game (And you love the game)" ## [85] "&#39;Cause we&#39;re young and we&#39;re reckless (Yeah)" ## [86] "We&#39;ll take this way too far (Ooh)" ## [87] "It&#39;ll leave you breathless, mm" ## [88] "Or with a nasty scar (With a nasty scar)" ## [89] "Got a long list of ex-lovers" ## [90] "They&#39;ll tell you I&#39;m insane" ## [91] "But I&#39;ve got a blank space, baby" ## [92] "And I&#39;ll write your name1KEmbed" ``` --- # Steps: Cleaning (see: data/swift_data_raw) Obviously, there&#39;s a lot of work that was needed here. I did a rough clean -- for publication, I would probably do another pass or two and do some more spot checks. (I like to use a random number generator to select a row of my dataframe to verify that everything is good / looks OK). -- **Steps**: 1. Generate list of file paths (note I had to loop through albums to get songs). (HW05 was helpful for this) 1. Extract album title * Get title from path string * Add spaces back in where needed 1. Extract song title from file path * Get title from path string * Add spaces back in where needed 1. Read in data: * Read lines from path * Remove the top line * Get rid of any chunks about song structure 1. Merge data (Album, Song, Lyrics) and export as data frame --- # Steps: Data transformation * Remove stop words (sort of interesting, what do you do about songs like, &#39;the 1&#39;?). * Perform analysis on entire corpus and by album: * Frequency of words (histogram and wordcloud) * Sentiment of words (positive / negative) * Emotional score for text and albums * Consider future steps: "eras" and "eras tour"??? --- # Steps: Perform analysis on entire corpus vs albums For this, we want to explore the most common words used by Taylor Swift overall. We can then consider how we might want to break things out in future anlaysis. *(Note, this was a rough clean, so we have some words that don&#39;t fully make sense in here).* -- .panelset[ .panel[.panel-name[Overall Analysis] <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words.png" alt="Histogram of most frequent words in Taylor Swift songs" width="30%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs</p> </div> ] .panel[.panel-name[Wordcloud] <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud.png" alt="Wordcloud of most frequent tokens in Taylor Swift songs" width="40%" /> <p class="caption">Wordcloud of most frequent tokens in Taylor Swift songs</p> </div> ] .panel[.panel-name[Wordcloud: Pos/Neg] <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud_pos_neg.png" alt="Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics" width="40%" /> <p class="caption">Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics</p> </div> ] .panel[.panel-name[Analysis by Album] <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="50%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> ] ] --- # Steps: Visualizations (Wordcloud) Here, we can explore the word cloud generated from the text. THESE ARE NOT FOR ANALYSIS. YES THEY ARE COOL. NO THEY ARE NOT ANALYSIS!!! -- <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud.png" alt="Word cloud of popular tokens" width="40%" /> <p class="caption">Word cloud of popular tokens</p> </div> --- ## Trajectory: Thinking about word use <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from &#39;girl&#39; in her early albums to &#39;woman&#39; in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. --- ## Trajectory: Thinking about word use (tf-idf) When calculating tf-idf, we&#39;re looking for words that are more common relative to the rest of the corpus. We can think of this as an &#39;album signature&#39; in our case. Here, we can see that we get a collection of different words than when we just look at the most frequent words. <div class="figure" style="text-align: center"> <img src="../../img/ts_idf_words.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from &#39;girl&#39; in her early albums to &#39;woman&#39; in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. --- # (reminder / review) LDA: TOPICS LDA (Laten Dirichlet Allocation) is one method for fitting a topic model. It offers a means of *unsupervised* classification of a collection of documents. (I think of it as you dump a bunch of items into a pile and it sorts them for you based on patterns it finds...although the same item could appear in multiple piles). Small / simple example: suppose you have a list of a bunch of animals that you want grouped. You give it the following: dog, cat, parakeet, tiger, polar bear, lion, penguin. If you tell the model you want three topics, it might provide the following groups: * Topic 1: Dog, cat, parakeet * Topic 2: Parakeet, penguin, polar bear * Topic 3: Cat, tiger, lion -- It&#39;s up to you, the researcher, to determine what meaning or value lies within these topics / allocations. You may also determine how many topics you would like (more topics can mean a slower model). If you had said two topics, you might have gotten the following instead: * Topic 1: Dog, cat, parakeet * Topic 2: Penguin, polar bear, tiger, lion Notice that the &#39;sense&#39; you make of the topics might be different in the two situations. --- # LDA: Two topic model Let&#39;s start with a simple two-topic model (we&#39;ll get more complicated soon!) <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_topics.png" alt="Frequent words in a two-topic model" width="50%" /> <p class="caption">Frequent words in a two-topic model</p> </div> -- We can think about what we might &#39;call&#39; these topics and how we might want to explore this further. (Again, note this is unsupervised!) --- # LDA: understanding the right number of topics Let&#39;s try that again, but now with different numbers of topics. I have a visualization that is a little different from the text because I felt like it helped visualize the results better. We could do boxplots, but those were a bit messy for this particular dataset. -- .panelset[ .panel[.panel-name[Two topics] <div class="figure" style="text-align: center"> <img src="../../img/ts_2topics.png" alt="Text plot of songs, colored by albums (two topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (two topics)</p> </div> ] .panel[.panel-name[Three topics] <div class="figure" style="text-align: center"> <img src="../../img/ts_3topics.png" alt="Text plot of songs, colored by albums (three topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (three topics)</p> </div> ] .panel[.panel-name[Ten topics!] <div class="figure" style="text-align: center"> <img src="../../img/ts_10topics.png" alt="Text plot of songs, colored by albums (ten topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (ten topics)</p> </div> ] ] --- # Reflection: I think two topics makes sense here, of our options. However, I would be interested in pooling albums and reassessing to see. Alternatively, we might want to think about other ways to explore the meaning / distinctions. --- # Topic modeling: pros/cons * Topic models **account for "multiplexity":** a given document is unlikely to fall precisely and fully into a single topic * Topic models **do not care about the order of words** “dog eats food" is the same as "food eats dog" * To determine the "right" number of topics: no fixed rule, it is a try-error process, ultimately **the researcher decides** (there are some metrics, such as perplexity and coherence score but are beyond our goals) * Topics are **unlabeled:** they are just a bunch of words, it is up to the researcher to read, interpret, and label them * Topic models are **no substitute for human interpretation of a text:** they are a way of making educated guesses about how words cohere into different latent themes by identifying patterns in the way they co-occur within documents. Many people are somewhat disappointed when they discover their model produces uninformative results --- # LDAvis LDAvis is a an interactive visualization of LDA model results https://github.com/cpsievert/LDAvis 1. What is the meaning of each topic? 1. How prevalent is each topic? 1. How do the topics relate to each other? --- class: inverse, middle # Sentiment Analysis --- # Sentiment Analysis Use of NLP and programming to **study emotional states and subjective information in a text**. In practice sentiment analysis is usually applied: * to determine the polarity of a text: whether a text is positive, negative, or neutral * to detect specific feelings and emotions: angry, sad, happy, etc. * examples: analyzing costumer feedback, classify movies review Different from Topic Modeling, Sentiment Analysis it is usually supervised (e.g., needs a labeled input to compare our text to) --- # Sentiment Analysis: our approach Our approach to sentiment analysis (consistent with the book, Chapter 2): * consider the text a combination of its individual words, and * consider the sentiment content of the text as the sum of the sentiment content of the individual words Notice: "This isn’t the only way to approach sentiment analysis, but it is an often-used approach, and an approach that naturally takes advantage of the tidy tool ecosystem." --- # The `sentiments` datasets The tidytext package provides access to several sentiment lexicons: + **AFINN** from Finn Årup Nielsen (words classified with on a scale from -5 to +5) + **bing** from Bing Liu and collaborators (words classified into binary categories: negative and positive) + **nrc** from Saif Mohammad and Peter Turney (words classified in multiple categories) See: https://www.tidytextmining.com/sentiment.html#the-sentiments-datasets --- # The `sentiments` datasets These dictionaries constitute our gold standard (e.g., our labeled sentiments): we use them to classify our texts. Dictionary-based methods like these find the total sentiment of a piece of text by adding up the individual sentiment scores for each word in the text. --- # Sentiment Analysis: Examples **Examples from the book**: Chapter 2, and the three case-study chapters **Another example (in today&#39;s class-materials)**: sentiment analysis of Harry Potter textual data. **Another example (in today&#39;s class-materials)**: sentiment analysis of Taylor Swift albums --- class: middle, inverse, center # Back to TS ![](https://media.giphy.com/media/u23zXEvNsIbfO/giphy.gif) --- # Steps: Analysis -- Sentiment Here, we can look at the sentiment within her work: specifically, what are the positive and negative words used, both overall and by album? -- .panelset[ .panel[.panel-name[Overall Analysis] <div class="figure" style="text-align: center"> <img src="../../img/ts_sentiment.png" alt="Histogram of positive and negative sentiment in Taylor Swift songs" width="40%" /> <p class="caption">Histogram of positive and negative sentiment in Taylor Swift songs</p> </div> ] .panel[.panel-name[Analysis by Album: Positive] <div class="figure" style="text-align: center"> <img src="../../img/ts_positive_words_album.png" alt="Histogram of positive sentiment in Taylor Swift songs by album" width="40%" /> <p class="caption">Histogram of positive sentiment in Taylor Swift songs by album</p> </div> ] .panel[.panel-name[Analysis by Album: Negative] <div class="figure" style="text-align: center"> <img src="../../img/ts_negative_words_album.png" alt="Histogram of negative sentiment in Taylor Swift songs by album" width="40%" /> <p class="caption">Histogram of negative sentiment in Taylor Swift songs by album</p> </div> ] ] --- # Steps: Analysis (Negative Sentiment) Again, here some expertise / background on Taylor Swift can be helpful to make sense of our analysis. We can see that her early work has less &#39;intense&#39; (generally) language and the negative sentiment features words like, &#39;crazy,&#39; &#39;sad,&#39; and &#39;bad&#39;. With Reputation, we see a shift (this makes sense given the album and its role in her discography). Here, we see words like &#39;hate&#39; come in and, as we move into more recent albums, words like &#39;death,&#39; &#39;shit,&#39; &#39;kill.&#39; <div class="figure" style="text-align: center"> <img src="../../img/ts_negative_words_album.png" alt="Histogram of negative words by album" width="45%" /> <p class="caption">Histogram of negative words by album</p> </div> # Steps: Analysis (Negative Sentiment) With positive words, we see a lot of consistency (&#39;like&#39;) and while there are some more &#39;innocent&#39; words appearing with more frequency in earlier albums, we don&#39;t see as much change / evolution as we did with the negative words. If anything, the language has gotten more direct in the later work (which, particularly thinking about 1989 and Midnights, makes sense). -- <div class="figure" style="text-align: center"> <img src="../../img/ts_positive_words_album.png" alt="Histogram of postive words used by album" width="45%" /> <p class="caption">Histogram of postive words used by album</p> </div> --- # Steps: Visualizations -- <div class="figure" style="text-align: center"> <img src="../../img/ts_sentiment_album.png" alt="Emotional arc of TS albums" width="40%" /> <p class="caption">Emotional arc of TS albums</p> </div> --- class: inverse, middle, center ![](https://media.giphy.com/media/ej1WNA2G75DfUai7NR/giphy.gif) --- # Recap: * There are methods for analyzing text and getting a sense of the common ideas and topics that emerge * Unsupervised (easier), supervised (need training data of some kind) can provide techniques to offer deeper insights * Sentiment analysis looks at overall valence of words * Lots of room for researcher to interpret: can be difficult to do well and needs some expertise to evaluate. --- # Acknowledgements The content of these slides is derived in part from Sabrina Nardin and Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. I developed the Taylor Swift example using data from [Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums/versions/12?resource=download) and building on code from [Text Mining in R](https://www.tidytextmining.com/). Any errors or oversights are mine alone. --- class: middle, center, inverse # THANK YOU ALL FOR A GREAT CLASS! I have genuinely enjoyed getting to know you and your work and hope you keep in touch regarding how you use R in the future! We have one assignment remaining. Have a great rest of your summer!'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="slides"><meta itemprop=name content="CFSS: Computing for the Social Sciences"><meta itemprop=description content='<!DOCTYPE html> Text analysis: topic modeling and sentiment analysis class: center, middle, inverse, title-slide .title[ # Text analysis: topic modeling and sentiment analysis ] .author[ ### MACSS 30500 University of Chicago ] --- # Agenda * Topic Modeling * LDA * Sentiment Analysis * Positive / negative sentiment * Application: TS! * Future applications: * Author prediction --- class: inverse, middle # Topic Modeling --- # Topic Modeling Method to organize and understand large collections of textual information (without reading them). How? -- By **finding groups of words ("topics") that go together.** Words that co-occur more frequently that chance alone would predict are assigned to the same topic. Example: organizing 1.2M books into 2000 topics see David Mimno [slides here](https://mimno.infosci.cornell.edu/slides/details.pdf) and [video here](https://vimeo.com/53080123). --- # Topic Modeling **Word Frequency** looks at the exact recurrence of each word in a corpus (using a simple count or a weighted count). Instead: **Topic Modeling** looks at how groups of words co-occur together (using probability). -- Intuition: The meaning of words is dependent upon the broader context in which they are used. --- # Topic Modeling A topic is a set of words that are associated with one another, showing an underlying common theme that is semantically interpretable by humans. A topic is similar to what a human would call a theme or a discourse: whenever a specific discourse is made, some words tend to come up more frequently than others. The goal of TM is to identify the discourses that characterize a collection of documents. --- # Topic Modeling One way to think about how TM… Imagine working through an article with a set of highlighters. As you read through the article: * you use a different color for the key words of themes within the article as you encounter them * when you were done, you could take all words of the same color and create separate lists (one per each topic) --- # Topic Modeling <img src="tm.png" width="90%" style="display: block; margin: auto;" /> --- # Topic Modeling: LDA TM is the name of a family of algorithms. The most common is **LDA or Latent Dirichlet Allocation**. This model assumes that: 1. every document in a corpus contains a mixture of topics that are found throughout the entire corpus 1. each topic is made of a (limited) mixture of characteristic words, which tend to occur together whenever the topic is displayed The topic structure is hidden ("latent"): we can only observe the documents and words, not the topics themselves; the goal is to infer such topics by the words and documents (more formally: topic modeling computes the conditional posterior distribution of latent variables, e.g. topics, given the observed variables, e.g. words in documents). --- # Topic Modeling: LDA **LDA works as follows:** 1. The researcher begins by setting an arbitrary number of topics (`k`) for the whole collection of documents. 1. The algorithm (Gibbs sampling) creates, simultaneously: * a first randomly chosen word-topic probability: distribution of topics over all observed words in the collection * a first randomly chosen document-topic probability: distribution of topics by document 1. Through reiterative attempts, the algorithm adjusts these initial distributions to provide a set of probabilities for every word-topic pair and for every document-topic pair. --- # Topic Modeling: LDA **LDA produces two types of output:** 1. words most frequently associated with each of the `k` topics specified by the researcher 1. documents most frequently associated with each of the `k` topics (the researcher defines a probability threshold) --- # Topic Modeling: LDA simple example We start with a simple example, then move to a real example in R. Imagine we have a corpus with the following five documents (each document is one sentence): **Document 1** I ate a banana and spinach smoothie for breakfast. **Document 2** I like to eat broccoli and bananas. **Document 3** Puppies and kittens are cute. **Document 4** My sister adopted a kitten yesterday. **Document 5** This cute hamster is eating a piece of broccoli. --- # Topic Modeling: LDA simple example **First, we need to transform these textual data in the appropriate form needed for LDA:** * input: * raw data * output: * create a vocabulary (remove stop words, lowercase, tokenize, etc.) * create a document-term matrix **Then, we run LDA:** * input: * the document-term matrix as input * the number of topics we want to generate (we decide them) * output: * the word-topic and document-topic probabilities --- # Topic Modeling: LDA simple example If we give to LDA the document-term matrix from these 5 documents, and we ask for 2 topics, LDA might produce something like: **Topic A:** 30% eat, 20% broccoli, 15% bananas, 10% breakfast, … **Topic B:** 20% dog, 20% kitten, 20% cute, 15% hamster, … -- **Document 1 and 2** 100% Topic A (we can label it "food") **Document 3 and 4**: 100% Topic B (we can label it "cute animals") **Document 5:** 60% Topic A, 40% Topic B --- # Topic Modeling: LDA example in R Download today&#39;s class materials to access the code. (`usethis::use_course("CFSS-MACSS/text-analysis-fundamentals-and-sentiment-analysis-and-tm")`) We have additional resources you can practice with as well! **Examples from the book**: Chapter 6, and the three case-study chapters + Chapter 2 to reshape the data into the appropriate format for LDA --- class: inverse, middle, center ![](https://media.giphy.com/media/tNTq5fw9apN2OzZID9/giphy.gif) --- # A thorough examination of Taylor Swift Lyrics -- Recall the following graphic: ![visualization of textual analysis process](https://www.tidytextmining.com/images/tmwr_0101.png) -- We will move through this process using [this dataset of Taylor Swift albums and lyrics from Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums?resource=download) --- ## Basic workflow for text analysis We can think at the basic workflow as a 4-step process: 1. Obtain your textual data: **Kaggle, check!** 1. Data cleaning and pre-processing **OOF THIS WAS A PAIN** *see end of slides for more detail* 1. Data transformation **building on last class&#39;s materials** 1. Perform analysis **the fun part** --- # Steps: Data cleaning and pre-processing (see: data/swift_data_raw) To find the data, I googled things like, &#39;taylor swift lyrics dataset&#39; before finding the dataset on kaggle. I then spot-checked some of the albums and songs to be sure that things looked generally OK. (remember, once you use someone else&#39;s data, it becomes your problem!) I pulled all this in and tried to use specific code and packages that we&#39;ve used in class as much as possible so you could see where the pieces came from. Without belaboring this too much, you can see in today&#39;s files where I have the raw data I imported and cleaned, and how I timmed out unwanted characteristics / elements, e.g. [Chorus]. --- # Steps: Data cleaning and pre-processing (see: data/swift_data_raw) Here is a snippet of what the raw structure was: `data > albums > 1989 > song.txt` -- Here is what the raw txt file looked like: ```r strwrap(read_lines(here("..", "text-analysis-fundamentals-and-sentiment-analysis-and-tm", "data", "swift_data_raw", "Albums", "1989", "BlankSpace.txt")), 80) ## [1] "237 ContributorsTranslationsTürkçeEspañolPortuguêsPolskiΕλληνικάFrançaisBlank" ## [2] "Space Lyrics[Verse 1]" ## [3] "Nice to meet you, where you been?" ## [4] "I could show you incredible things" ## [5] "Magic, madness, heaven, sin" ## [6] "Saw you there and I thought" ## [7] "\"Oh, my God, look at that face" ## [8] "You look like my next mistake" ## [9] "Love&#39;s a game, wanna play?\" Ayy" ## [10] "New money, suit and tie" ## [11] "I can read you like a magazine" ## [12] "Ain&#39;t it funny? Rumors fly" ## [13] "And I know you heard about me" ## [14] "So, hey, let&#39;s be friends" ## [15] "I&#39;m dying to see how this one ends" ## [16] "Grab your passport and my hand" ## [17] "I can make the bad guys good for a weekend" ## [18] "[Chorus]" ## [19] "So, it&#39;s gonna be forever" ## [20] "Or it&#39;s gonna go down in flames?" ## [21] "You can tell me when it&#39;s over, mm" ## [22] "If the high was worth the pain" ## [23] "Got a long list of ex-lovers" ## [24] "They&#39;ll tell you I&#39;m insane" ## [25] "&#39;Cause you know I love the players" ## [26] "And you love the game" ## [27] "&#39;Cause we&#39;re young and we&#39;re reckless" ## [28] "We&#39;ll take this way too far" ## [29] "It&#39;ll leave you breathless, mm" ## [30] "Or with a nasty scar" ## [31] "Got a long list of ex-lovers" ## [32] "They&#39;ll tell you I&#39;m insane" ## [33] "But I&#39;ve got a blank space, baby" ## [34] "And I&#39;ll write your name" ## [35] "" ## [36] "[Verse 2]" ## [37] "Cherry lips, crystal skies" ## [38] "I could show you incredible things" ## [39] "Stolen kisses, pretty lies" ## [40] "You&#39;re the king, baby, I&#39;m your queen" ## [41] "Find out what you want" ## [42] "Be that girl for a month" ## [43] "Wait, the worst is yet to come, oh, no" ## [44] "Screaming, crying, perfect storms" ## [45] "I can make all the tables turn" ## [46] "Rose garden filled with thorns" ## [47] "Keep you second guessing, like" ## [48] "\"Oh, my God, who is she?\"" ## [49] "I get drunk on jealousy" ## [50] "But you&#39;ll come back each time you leave" ## [51] "&#39;Cause, darling, I&#39;m a nightmare dressed like a daydream" ## [52] "You might also like[Chorus]" ## [53] "So, it&#39;s gonna be forever" ## [54] "Or it&#39;s gonna go down in flames?" ## [55] "You can tell me when it&#39;s over, mm" ## [56] "If the high was worth the pain" ## [57] "Got a long list of ex-lovers" ## [58] "They&#39;ll tell you I&#39;m insane" ## [59] "&#39;Cause you know I love the players" ## [60] "And you love the game" ## [61] "&#39;Cause we&#39;re young and we&#39;re reckless (Oh)" ## [62] "We&#39;ll take this way too far" ## [63] "It&#39;ll leave you breathless (Oh-oh), mm" ## [64] "Or with a nasty scar" ## [65] "Got a long list of ex-lovers" ## [66] "They&#39;ll tell you I&#39;m insane (Insane)" ## [67] "But I&#39;ve got a blank space, baby" ## [68] "And I&#39;ll write your name" ## [69] "" ## [70] "[Bridge]" ## [71] "Boys only want love if it&#39;s torture" ## [72] "Don&#39;t say I didn&#39;t, say I didn&#39;t warn ya" ## [73] "Boys only want love if it&#39;s torture" ## [74] "Don&#39;t say I didn&#39;t, say I didn&#39;t warn ya" ## [75] "" ## [76] "[Chorus]" ## [77] "So, it&#39;s gonna be forever" ## [78] "Or it&#39;s gonna go down in flames?" ## [79] "You can tell me when it&#39;s over (Over), mm" ## [80] "If the high was worth the pain" ## [81] "Got a long list of ex-lovers" ## [82] "They&#39;ll tell you I&#39;m insane (I&#39;m insane)" ## [83] "&#39;Cause you know I love the players" ## [84] "And you love the game (And you love the game)" ## [85] "&#39;Cause we&#39;re young and we&#39;re reckless (Yeah)" ## [86] "We&#39;ll take this way too far (Ooh)" ## [87] "It&#39;ll leave you breathless, mm" ## [88] "Or with a nasty scar (With a nasty scar)" ## [89] "Got a long list of ex-lovers" ## [90] "They&#39;ll tell you I&#39;m insane" ## [91] "But I&#39;ve got a blank space, baby" ## [92] "And I&#39;ll write your name1KEmbed" ``` --- # Steps: Cleaning (see: data/swift_data_raw) Obviously, there&#39;s a lot of work that was needed here. I did a rough clean -- for publication, I would probably do another pass or two and do some more spot checks. (I like to use a random number generator to select a row of my dataframe to verify that everything is good / looks OK). -- **Steps**: 1. Generate list of file paths (note I had to loop through albums to get songs). (HW05 was helpful for this) 1. Extract album title * Get title from path string * Add spaces back in where needed 1. Extract song title from file path * Get title from path string * Add spaces back in where needed 1. Read in data: * Read lines from path * Remove the top line * Get rid of any chunks about song structure 1. Merge data (Album, Song, Lyrics) and export as data frame --- # Steps: Data transformation * Remove stop words (sort of interesting, what do you do about songs like, &#39;the 1&#39;?). * Perform analysis on entire corpus and by album: * Frequency of words (histogram and wordcloud) * Sentiment of words (positive / negative) * Emotional score for text and albums * Consider future steps: "eras" and "eras tour"??? --- # Steps: Perform analysis on entire corpus vs albums For this, we want to explore the most common words used by Taylor Swift overall. We can then consider how we might want to break things out in future anlaysis. *(Note, this was a rough clean, so we have some words that don&#39;t fully make sense in here).* -- .panelset[ .panel[.panel-name[Overall Analysis] <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words.png" alt="Histogram of most frequent words in Taylor Swift songs" width="30%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs</p> </div> ] .panel[.panel-name[Wordcloud] <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud.png" alt="Wordcloud of most frequent tokens in Taylor Swift songs" width="40%" /> <p class="caption">Wordcloud of most frequent tokens in Taylor Swift songs</p> </div> ] .panel[.panel-name[Wordcloud: Pos/Neg] <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud_pos_neg.png" alt="Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics" width="40%" /> <p class="caption">Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics</p> </div> ] .panel[.panel-name[Analysis by Album] <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="50%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> ] ] --- # Steps: Visualizations (Wordcloud) Here, we can explore the word cloud generated from the text. THESE ARE NOT FOR ANALYSIS. YES THEY ARE COOL. NO THEY ARE NOT ANALYSIS!!! -- <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud.png" alt="Word cloud of popular tokens" width="40%" /> <p class="caption">Word cloud of popular tokens</p> </div> --- ## Trajectory: Thinking about word use <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from &#39;girl&#39; in her early albums to &#39;woman&#39; in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. --- ## Trajectory: Thinking about word use (tf-idf) When calculating tf-idf, we&#39;re looking for words that are more common relative to the rest of the corpus. We can think of this as an &#39;album signature&#39; in our case. Here, we can see that we get a collection of different words than when we just look at the most frequent words. <div class="figure" style="text-align: center"> <img src="../../img/ts_idf_words.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from &#39;girl&#39; in her early albums to &#39;woman&#39; in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. --- # (reminder / review) LDA: TOPICS LDA (Laten Dirichlet Allocation) is one method for fitting a topic model. It offers a means of *unsupervised* classification of a collection of documents. (I think of it as you dump a bunch of items into a pile and it sorts them for you based on patterns it finds...although the same item could appear in multiple piles). Small / simple example: suppose you have a list of a bunch of animals that you want grouped. You give it the following: dog, cat, parakeet, tiger, polar bear, lion, penguin. If you tell the model you want three topics, it might provide the following groups: * Topic 1: Dog, cat, parakeet * Topic 2: Parakeet, penguin, polar bear * Topic 3: Cat, tiger, lion -- It&#39;s up to you, the researcher, to determine what meaning or value lies within these topics / allocations. You may also determine how many topics you would like (more topics can mean a slower model). If you had said two topics, you might have gotten the following instead: * Topic 1: Dog, cat, parakeet * Topic 2: Penguin, polar bear, tiger, lion Notice that the &#39;sense&#39; you make of the topics might be different in the two situations. --- # LDA: Two topic model Let&#39;s start with a simple two-topic model (we&#39;ll get more complicated soon!) <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_topics.png" alt="Frequent words in a two-topic model" width="50%" /> <p class="caption">Frequent words in a two-topic model</p> </div> -- We can think about what we might &#39;call&#39; these topics and how we might want to explore this further. (Again, note this is unsupervised!) --- # LDA: understanding the right number of topics Let&#39;s try that again, but now with different numbers of topics. I have a visualization that is a little different from the text because I felt like it helped visualize the results better. We could do boxplots, but those were a bit messy for this particular dataset. -- .panelset[ .panel[.panel-name[Two topics] <div class="figure" style="text-align: center"> <img src="../../img/ts_2topics.png" alt="Text plot of songs, colored by albums (two topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (two topics)</p> </div> ] .panel[.panel-name[Three topics] <div class="figure" style="text-align: center"> <img src="../../img/ts_3topics.png" alt="Text plot of songs, colored by albums (three topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (three topics)</p> </div> ] .panel[.panel-name[Ten topics!] <div class="figure" style="text-align: center"> <img src="../../img/ts_10topics.png" alt="Text plot of songs, colored by albums (ten topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (ten topics)</p> </div> ] ] --- # Reflection: I think two topics makes sense here, of our options. However, I would be interested in pooling albums and reassessing to see. Alternatively, we might want to think about other ways to explore the meaning / distinctions. --- # Topic modeling: pros/cons * Topic models **account for "multiplexity":** a given document is unlikely to fall precisely and fully into a single topic * Topic models **do not care about the order of words** “dog eats food" is the same as "food eats dog" * To determine the "right" number of topics: no fixed rule, it is a try-error process, ultimately **the researcher decides** (there are some metrics, such as perplexity and coherence score but are beyond our goals) * Topics are **unlabeled:** they are just a bunch of words, it is up to the researcher to read, interpret, and label them * Topic models are **no substitute for human interpretation of a text:** they are a way of making educated guesses about how words cohere into different latent themes by identifying patterns in the way they co-occur within documents. Many people are somewhat disappointed when they discover their model produces uninformative results --- # LDAvis LDAvis is a an interactive visualization of LDA model results https://github.com/cpsievert/LDAvis 1. What is the meaning of each topic? 1. How prevalent is each topic? 1. How do the topics relate to each other? --- class: inverse, middle # Sentiment Analysis --- # Sentiment Analysis Use of NLP and programming to **study emotional states and subjective information in a text**. In practice sentiment analysis is usually applied: * to determine the polarity of a text: whether a text is positive, negative, or neutral * to detect specific feelings and emotions: angry, sad, happy, etc. * examples: analyzing costumer feedback, classify movies review Different from Topic Modeling, Sentiment Analysis it is usually supervised (e.g., needs a labeled input to compare our text to) --- # Sentiment Analysis: our approach Our approach to sentiment analysis (consistent with the book, Chapter 2): * consider the text a combination of its individual words, and * consider the sentiment content of the text as the sum of the sentiment content of the individual words Notice: "This isn’t the only way to approach sentiment analysis, but it is an often-used approach, and an approach that naturally takes advantage of the tidy tool ecosystem." --- # The `sentiments` datasets The tidytext package provides access to several sentiment lexicons: + **AFINN** from Finn Årup Nielsen (words classified with on a scale from -5 to +5) + **bing** from Bing Liu and collaborators (words classified into binary categories: negative and positive) + **nrc** from Saif Mohammad and Peter Turney (words classified in multiple categories) See: https://www.tidytextmining.com/sentiment.html#the-sentiments-datasets --- # The `sentiments` datasets These dictionaries constitute our gold standard (e.g., our labeled sentiments): we use them to classify our texts. Dictionary-based methods like these find the total sentiment of a piece of text by adding up the individual sentiment scores for each word in the text. --- # Sentiment Analysis: Examples **Examples from the book**: Chapter 2, and the three case-study chapters **Another example (in today&#39;s class-materials)**: sentiment analysis of Harry Potter textual data. **Another example (in today&#39;s class-materials)**: sentiment analysis of Taylor Swift albums --- class: middle, inverse, center # Back to TS ![](https://media.giphy.com/media/u23zXEvNsIbfO/giphy.gif) --- # Steps: Analysis -- Sentiment Here, we can look at the sentiment within her work: specifically, what are the positive and negative words used, both overall and by album? -- .panelset[ .panel[.panel-name[Overall Analysis] <div class="figure" style="text-align: center"> <img src="../../img/ts_sentiment.png" alt="Histogram of positive and negative sentiment in Taylor Swift songs" width="40%" /> <p class="caption">Histogram of positive and negative sentiment in Taylor Swift songs</p> </div> ] .panel[.panel-name[Analysis by Album: Positive] <div class="figure" style="text-align: center"> <img src="../../img/ts_positive_words_album.png" alt="Histogram of positive sentiment in Taylor Swift songs by album" width="40%" /> <p class="caption">Histogram of positive sentiment in Taylor Swift songs by album</p> </div> ] .panel[.panel-name[Analysis by Album: Negative] <div class="figure" style="text-align: center"> <img src="../../img/ts_negative_words_album.png" alt="Histogram of negative sentiment in Taylor Swift songs by album" width="40%" /> <p class="caption">Histogram of negative sentiment in Taylor Swift songs by album</p> </div> ] ] --- # Steps: Analysis (Negative Sentiment) Again, here some expertise / background on Taylor Swift can be helpful to make sense of our analysis. We can see that her early work has less &#39;intense&#39; (generally) language and the negative sentiment features words like, &#39;crazy,&#39; &#39;sad,&#39; and &#39;bad&#39;. With Reputation, we see a shift (this makes sense given the album and its role in her discography). Here, we see words like &#39;hate&#39; come in and, as we move into more recent albums, words like &#39;death,&#39; &#39;shit,&#39; &#39;kill.&#39; <div class="figure" style="text-align: center"> <img src="../../img/ts_negative_words_album.png" alt="Histogram of negative words by album" width="45%" /> <p class="caption">Histogram of negative words by album</p> </div> # Steps: Analysis (Negative Sentiment) With positive words, we see a lot of consistency (&#39;like&#39;) and while there are some more &#39;innocent&#39; words appearing with more frequency in earlier albums, we don&#39;t see as much change / evolution as we did with the negative words. If anything, the language has gotten more direct in the later work (which, particularly thinking about 1989 and Midnights, makes sense). -- <div class="figure" style="text-align: center"> <img src="../../img/ts_positive_words_album.png" alt="Histogram of postive words used by album" width="45%" /> <p class="caption">Histogram of postive words used by album</p> </div> --- # Steps: Visualizations -- <div class="figure" style="text-align: center"> <img src="../../img/ts_sentiment_album.png" alt="Emotional arc of TS albums" width="40%" /> <p class="caption">Emotional arc of TS albums</p> </div> --- class: inverse, middle, center ![](https://media.giphy.com/media/ej1WNA2G75DfUai7NR/giphy.gif) --- # Recap: * There are methods for analyzing text and getting a sense of the common ideas and topics that emerge * Unsupervised (easier), supervised (need training data of some kind) can provide techniques to offer deeper insights * Sentiment analysis looks at overall valence of words * Lots of room for researcher to interpret: can be difficult to do well and needs some expertise to evaluate. --- # Acknowledgements The content of these slides is derived in part from Sabrina Nardin and Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. I developed the Taylor Swift example using data from [Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums/versions/12?resource=download) and building on code from [Text Mining in R](https://www.tidytextmining.com/). Any errors or oversights are mine alone. --- class: middle, center, inverse # THANK YOU ALL FOR A GREAT CLASS! I have genuinely enjoyed getting to know you and your work and hope you keep in touch regarding how you use R in the future! We have one assignment remaining. Have a great rest of your summer!'><meta itemprop=wordCount content="4086"><meta name=twitter:card content="summary"><meta name=twitter:title content="CFSS: Computing for the Social Sciences"><meta name=twitter:description content='<!DOCTYPE html> Text analysis: topic modeling and sentiment analysis class: center, middle, inverse, title-slide .title[ # Text analysis: topic modeling and sentiment analysis ] .author[ ### MACSS 30500 University of Chicago ] --- # Agenda * Topic Modeling * LDA * Sentiment Analysis * Positive / negative sentiment * Application: TS! * Future applications: * Author prediction --- class: inverse, middle # Topic Modeling --- # Topic Modeling Method to organize and understand large collections of textual information (without reading them). How? -- By **finding groups of words ("topics") that go together.** Words that co-occur more frequently that chance alone would predict are assigned to the same topic. Example: organizing 1.2M books into 2000 topics see David Mimno [slides here](https://mimno.infosci.cornell.edu/slides/details.pdf) and [video here](https://vimeo.com/53080123). --- # Topic Modeling **Word Frequency** looks at the exact recurrence of each word in a corpus (using a simple count or a weighted count). Instead: **Topic Modeling** looks at how groups of words co-occur together (using probability). -- Intuition: The meaning of words is dependent upon the broader context in which they are used. --- # Topic Modeling A topic is a set of words that are associated with one another, showing an underlying common theme that is semantically interpretable by humans. A topic is similar to what a human would call a theme or a discourse: whenever a specific discourse is made, some words tend to come up more frequently than others. The goal of TM is to identify the discourses that characterize a collection of documents. --- # Topic Modeling One way to think about how TM… Imagine working through an article with a set of highlighters. As you read through the article: * you use a different color for the key words of themes within the article as you encounter them * when you were done, you could take all words of the same color and create separate lists (one per each topic) --- # Topic Modeling <img src="tm.png" width="90%" style="display: block; margin: auto;" /> --- # Topic Modeling: LDA TM is the name of a family of algorithms. The most common is **LDA or Latent Dirichlet Allocation**. This model assumes that: 1. every document in a corpus contains a mixture of topics that are found throughout the entire corpus 1. each topic is made of a (limited) mixture of characteristic words, which tend to occur together whenever the topic is displayed The topic structure is hidden ("latent"): we can only observe the documents and words, not the topics themselves; the goal is to infer such topics by the words and documents (more formally: topic modeling computes the conditional posterior distribution of latent variables, e.g. topics, given the observed variables, e.g. words in documents). --- # Topic Modeling: LDA **LDA works as follows:** 1. The researcher begins by setting an arbitrary number of topics (`k`) for the whole collection of documents. 1. The algorithm (Gibbs sampling) creates, simultaneously: * a first randomly chosen word-topic probability: distribution of topics over all observed words in the collection * a first randomly chosen document-topic probability: distribution of topics by document 1. Through reiterative attempts, the algorithm adjusts these initial distributions to provide a set of probabilities for every word-topic pair and for every document-topic pair. --- # Topic Modeling: LDA **LDA produces two types of output:** 1. words most frequently associated with each of the `k` topics specified by the researcher 1. documents most frequently associated with each of the `k` topics (the researcher defines a probability threshold) --- # Topic Modeling: LDA simple example We start with a simple example, then move to a real example in R. Imagine we have a corpus with the following five documents (each document is one sentence): **Document 1** I ate a banana and spinach smoothie for breakfast. **Document 2** I like to eat broccoli and bananas. **Document 3** Puppies and kittens are cute. **Document 4** My sister adopted a kitten yesterday. **Document 5** This cute hamster is eating a piece of broccoli. --- # Topic Modeling: LDA simple example **First, we need to transform these textual data in the appropriate form needed for LDA:** * input: * raw data * output: * create a vocabulary (remove stop words, lowercase, tokenize, etc.) * create a document-term matrix **Then, we run LDA:** * input: * the document-term matrix as input * the number of topics we want to generate (we decide them) * output: * the word-topic and document-topic probabilities --- # Topic Modeling: LDA simple example If we give to LDA the document-term matrix from these 5 documents, and we ask for 2 topics, LDA might produce something like: **Topic A:** 30% eat, 20% broccoli, 15% bananas, 10% breakfast, … **Topic B:** 20% dog, 20% kitten, 20% cute, 15% hamster, … -- **Document 1 and 2** 100% Topic A (we can label it "food") **Document 3 and 4**: 100% Topic B (we can label it "cute animals") **Document 5:** 60% Topic A, 40% Topic B --- # Topic Modeling: LDA example in R Download today&#39;s class materials to access the code. (`usethis::use_course("CFSS-MACSS/text-analysis-fundamentals-and-sentiment-analysis-and-tm")`) We have additional resources you can practice with as well! **Examples from the book**: Chapter 6, and the three case-study chapters + Chapter 2 to reshape the data into the appropriate format for LDA --- class: inverse, middle, center ![](https://media.giphy.com/media/tNTq5fw9apN2OzZID9/giphy.gif) --- # A thorough examination of Taylor Swift Lyrics -- Recall the following graphic: ![visualization of textual analysis process](https://www.tidytextmining.com/images/tmwr_0101.png) -- We will move through this process using [this dataset of Taylor Swift albums and lyrics from Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums?resource=download) --- ## Basic workflow for text analysis We can think at the basic workflow as a 4-step process: 1. Obtain your textual data: **Kaggle, check!** 1. Data cleaning and pre-processing **OOF THIS WAS A PAIN** *see end of slides for more detail* 1. Data transformation **building on last class&#39;s materials** 1. Perform analysis **the fun part** --- # Steps: Data cleaning and pre-processing (see: data/swift_data_raw) To find the data, I googled things like, &#39;taylor swift lyrics dataset&#39; before finding the dataset on kaggle. I then spot-checked some of the albums and songs to be sure that things looked generally OK. (remember, once you use someone else&#39;s data, it becomes your problem!) I pulled all this in and tried to use specific code and packages that we&#39;ve used in class as much as possible so you could see where the pieces came from. Without belaboring this too much, you can see in today&#39;s files where I have the raw data I imported and cleaned, and how I timmed out unwanted characteristics / elements, e.g. [Chorus]. --- # Steps: Data cleaning and pre-processing (see: data/swift_data_raw) Here is a snippet of what the raw structure was: `data > albums > 1989 > song.txt` -- Here is what the raw txt file looked like: ```r strwrap(read_lines(here("..", "text-analysis-fundamentals-and-sentiment-analysis-and-tm", "data", "swift_data_raw", "Albums", "1989", "BlankSpace.txt")), 80) ## [1] "237 ContributorsTranslationsTürkçeEspañolPortuguêsPolskiΕλληνικάFrançaisBlank" ## [2] "Space Lyrics[Verse 1]" ## [3] "Nice to meet you, where you been?" ## [4] "I could show you incredible things" ## [5] "Magic, madness, heaven, sin" ## [6] "Saw you there and I thought" ## [7] "\"Oh, my God, look at that face" ## [8] "You look like my next mistake" ## [9] "Love&#39;s a game, wanna play?\" Ayy" ## [10] "New money, suit and tie" ## [11] "I can read you like a magazine" ## [12] "Ain&#39;t it funny? Rumors fly" ## [13] "And I know you heard about me" ## [14] "So, hey, let&#39;s be friends" ## [15] "I&#39;m dying to see how this one ends" ## [16] "Grab your passport and my hand" ## [17] "I can make the bad guys good for a weekend" ## [18] "[Chorus]" ## [19] "So, it&#39;s gonna be forever" ## [20] "Or it&#39;s gonna go down in flames?" ## [21] "You can tell me when it&#39;s over, mm" ## [22] "If the high was worth the pain" ## [23] "Got a long list of ex-lovers" ## [24] "They&#39;ll tell you I&#39;m insane" ## [25] "&#39;Cause you know I love the players" ## [26] "And you love the game" ## [27] "&#39;Cause we&#39;re young and we&#39;re reckless" ## [28] "We&#39;ll take this way too far" ## [29] "It&#39;ll leave you breathless, mm" ## [30] "Or with a nasty scar" ## [31] "Got a long list of ex-lovers" ## [32] "They&#39;ll tell you I&#39;m insane" ## [33] "But I&#39;ve got a blank space, baby" ## [34] "And I&#39;ll write your name" ## [35] "" ## [36] "[Verse 2]" ## [37] "Cherry lips, crystal skies" ## [38] "I could show you incredible things" ## [39] "Stolen kisses, pretty lies" ## [40] "You&#39;re the king, baby, I&#39;m your queen" ## [41] "Find out what you want" ## [42] "Be that girl for a month" ## [43] "Wait, the worst is yet to come, oh, no" ## [44] "Screaming, crying, perfect storms" ## [45] "I can make all the tables turn" ## [46] "Rose garden filled with thorns" ## [47] "Keep you second guessing, like" ## [48] "\"Oh, my God, who is she?\"" ## [49] "I get drunk on jealousy" ## [50] "But you&#39;ll come back each time you leave" ## [51] "&#39;Cause, darling, I&#39;m a nightmare dressed like a daydream" ## [52] "You might also like[Chorus]" ## [53] "So, it&#39;s gonna be forever" ## [54] "Or it&#39;s gonna go down in flames?" ## [55] "You can tell me when it&#39;s over, mm" ## [56] "If the high was worth the pain" ## [57] "Got a long list of ex-lovers" ## [58] "They&#39;ll tell you I&#39;m insane" ## [59] "&#39;Cause you know I love the players" ## [60] "And you love the game" ## [61] "&#39;Cause we&#39;re young and we&#39;re reckless (Oh)" ## [62] "We&#39;ll take this way too far" ## [63] "It&#39;ll leave you breathless (Oh-oh), mm" ## [64] "Or with a nasty scar" ## [65] "Got a long list of ex-lovers" ## [66] "They&#39;ll tell you I&#39;m insane (Insane)" ## [67] "But I&#39;ve got a blank space, baby" ## [68] "And I&#39;ll write your name" ## [69] "" ## [70] "[Bridge]" ## [71] "Boys only want love if it&#39;s torture" ## [72] "Don&#39;t say I didn&#39;t, say I didn&#39;t warn ya" ## [73] "Boys only want love if it&#39;s torture" ## [74] "Don&#39;t say I didn&#39;t, say I didn&#39;t warn ya" ## [75] "" ## [76] "[Chorus]" ## [77] "So, it&#39;s gonna be forever" ## [78] "Or it&#39;s gonna go down in flames?" ## [79] "You can tell me when it&#39;s over (Over), mm" ## [80] "If the high was worth the pain" ## [81] "Got a long list of ex-lovers" ## [82] "They&#39;ll tell you I&#39;m insane (I&#39;m insane)" ## [83] "&#39;Cause you know I love the players" ## [84] "And you love the game (And you love the game)" ## [85] "&#39;Cause we&#39;re young and we&#39;re reckless (Yeah)" ## [86] "We&#39;ll take this way too far (Ooh)" ## [87] "It&#39;ll leave you breathless, mm" ## [88] "Or with a nasty scar (With a nasty scar)" ## [89] "Got a long list of ex-lovers" ## [90] "They&#39;ll tell you I&#39;m insane" ## [91] "But I&#39;ve got a blank space, baby" ## [92] "And I&#39;ll write your name1KEmbed" ``` --- # Steps: Cleaning (see: data/swift_data_raw) Obviously, there&#39;s a lot of work that was needed here. I did a rough clean -- for publication, I would probably do another pass or two and do some more spot checks. (I like to use a random number generator to select a row of my dataframe to verify that everything is good / looks OK). -- **Steps**: 1. Generate list of file paths (note I had to loop through albums to get songs). (HW05 was helpful for this) 1. Extract album title * Get title from path string * Add spaces back in where needed 1. Extract song title from file path * Get title from path string * Add spaces back in where needed 1. Read in data: * Read lines from path * Remove the top line * Get rid of any chunks about song structure 1. Merge data (Album, Song, Lyrics) and export as data frame --- # Steps: Data transformation * Remove stop words (sort of interesting, what do you do about songs like, &#39;the 1&#39;?). * Perform analysis on entire corpus and by album: * Frequency of words (histogram and wordcloud) * Sentiment of words (positive / negative) * Emotional score for text and albums * Consider future steps: "eras" and "eras tour"??? --- # Steps: Perform analysis on entire corpus vs albums For this, we want to explore the most common words used by Taylor Swift overall. We can then consider how we might want to break things out in future anlaysis. *(Note, this was a rough clean, so we have some words that don&#39;t fully make sense in here).* -- .panelset[ .panel[.panel-name[Overall Analysis] <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words.png" alt="Histogram of most frequent words in Taylor Swift songs" width="30%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs</p> </div> ] .panel[.panel-name[Wordcloud] <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud.png" alt="Wordcloud of most frequent tokens in Taylor Swift songs" width="40%" /> <p class="caption">Wordcloud of most frequent tokens in Taylor Swift songs</p> </div> ] .panel[.panel-name[Wordcloud: Pos/Neg] <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud_pos_neg.png" alt="Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics" width="40%" /> <p class="caption">Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics</p> </div> ] .panel[.panel-name[Analysis by Album] <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="50%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> ] ] --- # Steps: Visualizations (Wordcloud) Here, we can explore the word cloud generated from the text. THESE ARE NOT FOR ANALYSIS. YES THEY ARE COOL. NO THEY ARE NOT ANALYSIS!!! -- <div class="figure" style="text-align: center"> <img src="../../img/ts_wordcloud.png" alt="Word cloud of popular tokens" width="40%" /> <p class="caption">Word cloud of popular tokens</p> </div> --- ## Trajectory: Thinking about word use <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from &#39;girl&#39; in her early albums to &#39;woman&#39; in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. --- ## Trajectory: Thinking about word use (tf-idf) When calculating tf-idf, we&#39;re looking for words that are more common relative to the rest of the corpus. We can think of this as an &#39;album signature&#39; in our case. Here, we can see that we get a collection of different words than when we just look at the most frequent words. <div class="figure" style="text-align: center"> <img src="../../img/ts_idf_words.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /> <p class="caption">Histogram of most frequent words in Taylor Swift songs by album</p> </div> Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from &#39;girl&#39; in her early albums to &#39;woman&#39; in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. --- # (reminder / review) LDA: TOPICS LDA (Laten Dirichlet Allocation) is one method for fitting a topic model. It offers a means of *unsupervised* classification of a collection of documents. (I think of it as you dump a bunch of items into a pile and it sorts them for you based on patterns it finds...although the same item could appear in multiple piles). Small / simple example: suppose you have a list of a bunch of animals that you want grouped. You give it the following: dog, cat, parakeet, tiger, polar bear, lion, penguin. If you tell the model you want three topics, it might provide the following groups: * Topic 1: Dog, cat, parakeet * Topic 2: Parakeet, penguin, polar bear * Topic 3: Cat, tiger, lion -- It&#39;s up to you, the researcher, to determine what meaning or value lies within these topics / allocations. You may also determine how many topics you would like (more topics can mean a slower model). If you had said two topics, you might have gotten the following instead: * Topic 1: Dog, cat, parakeet * Topic 2: Penguin, polar bear, tiger, lion Notice that the &#39;sense&#39; you make of the topics might be different in the two situations. --- # LDA: Two topic model Let&#39;s start with a simple two-topic model (we&#39;ll get more complicated soon!) <div class="figure" style="text-align: center"> <img src="../../img/ts_frequent_words_topics.png" alt="Frequent words in a two-topic model" width="50%" /> <p class="caption">Frequent words in a two-topic model</p> </div> -- We can think about what we might &#39;call&#39; these topics and how we might want to explore this further. (Again, note this is unsupervised!) --- # LDA: understanding the right number of topics Let&#39;s try that again, but now with different numbers of topics. I have a visualization that is a little different from the text because I felt like it helped visualize the results better. We could do boxplots, but those were a bit messy for this particular dataset. -- .panelset[ .panel[.panel-name[Two topics] <div class="figure" style="text-align: center"> <img src="../../img/ts_2topics.png" alt="Text plot of songs, colored by albums (two topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (two topics)</p> </div> ] .panel[.panel-name[Three topics] <div class="figure" style="text-align: center"> <img src="../../img/ts_3topics.png" alt="Text plot of songs, colored by albums (three topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (three topics)</p> </div> ] .panel[.panel-name[Ten topics!] <div class="figure" style="text-align: center"> <img src="../../img/ts_10topics.png" alt="Text plot of songs, colored by albums (ten topics)" width="40%" /> <p class="caption">Text plot of songs, colored by albums (ten topics)</p> </div> ] ] --- # Reflection: I think two topics makes sense here, of our options. However, I would be interested in pooling albums and reassessing to see. Alternatively, we might want to think about other ways to explore the meaning / distinctions. --- # Topic modeling: pros/cons * Topic models **account for "multiplexity":** a given document is unlikely to fall precisely and fully into a single topic * Topic models **do not care about the order of words** “dog eats food" is the same as "food eats dog" * To determine the "right" number of topics: no fixed rule, it is a try-error process, ultimately **the researcher decides** (there are some metrics, such as perplexity and coherence score but are beyond our goals) * Topics are **unlabeled:** they are just a bunch of words, it is up to the researcher to read, interpret, and label them * Topic models are **no substitute for human interpretation of a text:** they are a way of making educated guesses about how words cohere into different latent themes by identifying patterns in the way they co-occur within documents. Many people are somewhat disappointed when they discover their model produces uninformative results --- # LDAvis LDAvis is a an interactive visualization of LDA model results https://github.com/cpsievert/LDAvis 1. What is the meaning of each topic? 1. How prevalent is each topic? 1. How do the topics relate to each other? --- class: inverse, middle # Sentiment Analysis --- # Sentiment Analysis Use of NLP and programming to **study emotional states and subjective information in a text**. In practice sentiment analysis is usually applied: * to determine the polarity of a text: whether a text is positive, negative, or neutral * to detect specific feelings and emotions: angry, sad, happy, etc. * examples: analyzing costumer feedback, classify movies review Different from Topic Modeling, Sentiment Analysis it is usually supervised (e.g., needs a labeled input to compare our text to) --- # Sentiment Analysis: our approach Our approach to sentiment analysis (consistent with the book, Chapter 2): * consider the text a combination of its individual words, and * consider the sentiment content of the text as the sum of the sentiment content of the individual words Notice: "This isn’t the only way to approach sentiment analysis, but it is an often-used approach, and an approach that naturally takes advantage of the tidy tool ecosystem." --- # The `sentiments` datasets The tidytext package provides access to several sentiment lexicons: + **AFINN** from Finn Årup Nielsen (words classified with on a scale from -5 to +5) + **bing** from Bing Liu and collaborators (words classified into binary categories: negative and positive) + **nrc** from Saif Mohammad and Peter Turney (words classified in multiple categories) See: https://www.tidytextmining.com/sentiment.html#the-sentiments-datasets --- # The `sentiments` datasets These dictionaries constitute our gold standard (e.g., our labeled sentiments): we use them to classify our texts. Dictionary-based methods like these find the total sentiment of a piece of text by adding up the individual sentiment scores for each word in the text. --- # Sentiment Analysis: Examples **Examples from the book**: Chapter 2, and the three case-study chapters **Another example (in today&#39;s class-materials)**: sentiment analysis of Harry Potter textual data. **Another example (in today&#39;s class-materials)**: sentiment analysis of Taylor Swift albums --- class: middle, inverse, center # Back to TS ![](https://media.giphy.com/media/u23zXEvNsIbfO/giphy.gif) --- # Steps: Analysis -- Sentiment Here, we can look at the sentiment within her work: specifically, what are the positive and negative words used, both overall and by album? -- .panelset[ .panel[.panel-name[Overall Analysis] <div class="figure" style="text-align: center"> <img src="../../img/ts_sentiment.png" alt="Histogram of positive and negative sentiment in Taylor Swift songs" width="40%" /> <p class="caption">Histogram of positive and negative sentiment in Taylor Swift songs</p> </div> ] .panel[.panel-name[Analysis by Album: Positive] <div class="figure" style="text-align: center"> <img src="../../img/ts_positive_words_album.png" alt="Histogram of positive sentiment in Taylor Swift songs by album" width="40%" /> <p class="caption">Histogram of positive sentiment in Taylor Swift songs by album</p> </div> ] .panel[.panel-name[Analysis by Album: Negative] <div class="figure" style="text-align: center"> <img src="../../img/ts_negative_words_album.png" alt="Histogram of negative sentiment in Taylor Swift songs by album" width="40%" /> <p class="caption">Histogram of negative sentiment in Taylor Swift songs by album</p> </div> ] ] --- # Steps: Analysis (Negative Sentiment) Again, here some expertise / background on Taylor Swift can be helpful to make sense of our analysis. We can see that her early work has less &#39;intense&#39; (generally) language and the negative sentiment features words like, &#39;crazy,&#39; &#39;sad,&#39; and &#39;bad&#39;. With Reputation, we see a shift (this makes sense given the album and its role in her discography). Here, we see words like &#39;hate&#39; come in and, as we move into more recent albums, words like &#39;death,&#39; &#39;shit,&#39; &#39;kill.&#39; <div class="figure" style="text-align: center"> <img src="../../img/ts_negative_words_album.png" alt="Histogram of negative words by album" width="45%" /> <p class="caption">Histogram of negative words by album</p> </div> # Steps: Analysis (Negative Sentiment) With positive words, we see a lot of consistency (&#39;like&#39;) and while there are some more &#39;innocent&#39; words appearing with more frequency in earlier albums, we don&#39;t see as much change / evolution as we did with the negative words. If anything, the language has gotten more direct in the later work (which, particularly thinking about 1989 and Midnights, makes sense). -- <div class="figure" style="text-align: center"> <img src="../../img/ts_positive_words_album.png" alt="Histogram of postive words used by album" width="45%" /> <p class="caption">Histogram of postive words used by album</p> </div> --- # Steps: Visualizations -- <div class="figure" style="text-align: center"> <img src="../../img/ts_sentiment_album.png" alt="Emotional arc of TS albums" width="40%" /> <p class="caption">Emotional arc of TS albums</p> </div> --- class: inverse, middle, center ![](https://media.giphy.com/media/ej1WNA2G75DfUai7NR/giphy.gif) --- # Recap: * There are methods for analyzing text and getting a sense of the common ideas and topics that emerge * Unsupervised (easier), supervised (need training data of some kind) can provide techniques to offer deeper insights * Sentiment analysis looks at overall valence of words * Lots of room for researcher to interpret: can be difficult to do well and needs some expertise to evaluate. --- # Acknowledgements The content of these slides is derived in part from Sabrina Nardin and Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. I developed the Taylor Swift example using data from [Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums/versions/12?resource=download) and building on code from [Text Mining in R](https://www.tidytextmining.com/). Any errors or oversights are mine alone. --- class: middle, center, inverse # THANK YOU ALL FOR A GREAT CLASS! I have genuinely enjoyed getting to know you and your work and hope you keep in touch regarding how you use R in the future! We have one assignment remaining. Have a great rest of your summer!'><link rel=preload href=/scss/main.min.2bf6e9109f6f32347205312f445c5d7dea681b9fd1802a211b5786faf06a9b77.css as=style integrity="sha256-K/bpEJ9vMjRyBTEvRFxdfepoG5/RgCohG1eG+vBqm3c=" crossorigin=anonymous><link href=/scss/main.min.2bf6e9109f6f32347205312f445c5d7dea681b9fd1802a211b5786faf06a9b77.css rel=stylesheet integrity="sha256-K/bpEJ9vMjRyBTEvRFxdfepoG5/RgCohG1eG+vBqm3c=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>CFSS: Computing for the Social Sciences</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/syllabus/><span>Syllabus</span></a></li><li class=nav-item><a class=nav-link href=/schedule/><span>Schedule</span></a></li><li class=nav-item><a class=nav-link href=/assignments/><span>Assignments</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-default td-outer"><main role=main class=td-main><!doctype html><html lang xml:lang><head><title>Text analysis: topic modeling and sentiment analysis</title><meta charset=utf-8><meta name=author content="MACSS 30500   University of Chicago"><script src=index_files/header-attrs/header-attrs.js></script><link href=index_files/panelset/panelset.css rel=stylesheet><script src=index_files/panelset/panelset.js></script><link rel=stylesheet href=xaringan-themer.css type=text/css></head><body><textarea id=source>
class: center, middle, inverse, title-slide

.title[
# Text analysis: <br /> topic modeling and sentiment analysis
]
.author[
### MACSS 30500 <br /> University of Chicago
]

---






# Agenda
* Topic Modeling
  * LDA
* Sentiment Analysis
  * Positive / negative sentiment
* Application: TS!
* Future applications:  
      * Author prediction

---
class: inverse, middle

# Topic Modeling

---

# Topic Modeling

Method to organize and understand large collections of textual information (without reading them).

How?  
--
By **finding groups of words ("topics") that go together.** Words that co-occur more frequently that chance alone would predict are assigned to the same topic.

Example: organizing 1.2M books into 2000 topics see David Mimno [slides here](https://mimno.infosci.cornell.edu/slides/details.pdf) and [video here](https://vimeo.com/53080123). 

---

# Topic Modeling

**Word Frequency** looks at the exact recurrence of each word in a corpus (using a simple count or a weighted count).

Instead: 

**Topic Modeling** looks at how groups of words co-occur together (using probability).

--

Intuition: 

The meaning of words is dependent upon the broader context in which they are used. 

---

# Topic Modeling

A topic is a set of words that are associated with one another, showing an underlying common theme that is semantically interpretable by humans. 

A topic is similar to what a human would call a theme or a discourse: whenever a specific discourse is made, some words tend to come up more frequently than others. The goal of TM is to identify the discourses that characterize a collection of documents. 

---

# Topic Modeling

One way to think about how TM…

Imagine working through an article with a set of highlighters. As you read through the article:
  * you use a different color for the key words of themes within the article as you encounter them
  * when you were done, you could take all words of the same color and create separate lists (one per each topic)


---

# Topic Modeling

&lt;img src="tm.png" width="90%" style="display: block; margin: auto;" /&gt;

---

# Topic Modeling: LDA

TM is the name of a family of algorithms. The most common is **LDA or Latent Dirichlet Allocation**. This model assumes that:

1. every document in a corpus contains a mixture of topics that are found throughout the entire corpus

1. each topic is made of a (limited) mixture of characteristic words, which tend to occur together whenever the topic is displayed

The topic structure is hidden ("latent"): we can only observe the documents and words, not the topics themselves; the goal is to infer such topics by the words and documents (more formally: topic modeling computes the conditional posterior distribution of latent variables, e.g. topics, given the observed variables, e.g. words in documents).

---

# Topic Modeling: LDA

**LDA works as follows:**

1. The researcher begins by setting an arbitrary number of topics (`k`) for the whole collection of documents.

1. The algorithm (Gibbs sampling) creates, simultaneously:
    * a first randomly chosen word-topic probability: distribution of topics over all observed words in the collection
    * a first randomly chosen document-topic probability: distribution of topics by document 

1. Through reiterative attempts, the algorithm adjusts these initial distributions to provide a set of probabilities for every word-topic pair and for every document-topic pair. 

---

# Topic Modeling: LDA

**LDA produces two types of output:**

1. words most frequently associated with each of the `k` topics specified by the researcher 

1. documents most frequently associated with each of the `k` topics (the researcher defines a probability threshold)

---

# Topic Modeling: LDA simple example

We start with a simple example, then move to a real example in R. Imagine we have a corpus with the following five documents (each document is one sentence):

**Document 1**  I ate a banana and spinach smoothie for breakfast.

**Document 2**  I like to eat broccoli and bananas.

**Document 3**  Puppies and kittens are cute.

**Document 4**  My sister adopted a kitten yesterday.

**Document 5**  This cute hamster is eating a piece of broccoli.

---

# Topic Modeling: LDA simple example

**First, we need to transform these textual data in the appropriate form needed for LDA:**
* input:
  * raw data
* output:
  * create a vocabulary (remove stop words, lowercase, tokenize, etc.)
  * create a document-term matrix

**Then, we run LDA:**
* input:
  * the document-term matrix as input
  * the number of topics we want to generate (we decide them)
* output:
  * the word-topic and document-topic probabilities

---

# Topic Modeling: LDA simple example

If we give to LDA the document-term matrix from these 5 documents, and we ask for 2 topics, LDA might produce something like: 

**Topic A:** 30% eat, 20% broccoli, 15% bananas, 10% breakfast, …

**Topic B:** 20% dog, 20% kitten, 20% cute, 15% hamster, …

--

**Document 1 and 2** 100% Topic A (we can label it "food")

**Document 3 and 4**: 100% Topic B (we can label it "cute animals")

**Document 5:** 60% Topic A, 40% Topic B

---

# Topic Modeling: LDA example in R

Download today's class materials to access the code. (`usethis::use_course("CFSS-MACSS/text-analysis-fundamentals-and-sentiment-analysis-and-tm")`) We have additional resources you can practice with as well!

**Examples from the book**: Chapter 6, and the three case-study chapters + Chapter 2 to reshape the data into the appropriate format for LDA


---
class: inverse, middle, center

![](https://media.giphy.com/media/tNTq5fw9apN2OzZID9/giphy.gif) 

---
# A thorough examination of Taylor Swift Lyrics   
--
Recall the following graphic:  
![visualization of textual analysis process](https://www.tidytextmining.com/images/tmwr_0101.png)  
--

We will move through this process using [this dataset of Taylor Swift albums and lyrics from Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums?resource=download)

---
## Basic workflow for text analysis

We can think at the basic workflow as a 4-step process:

1. Obtain your textual data: **Kaggle, check!**

1. Data cleaning and pre-processing **OOF THIS WAS A PAIN** *see end of slides for more detail*

1. Data transformation **building on last class's materials**

1. Perform analysis **the fun part**


---
# Steps: Data cleaning and pre-processing    
(see: data/swift_data_raw)  
To find the data, I googled things like, 'taylor swift lyrics dataset' before finding the dataset on kaggle. I then spot-checked some of the albums and songs to be sure that things looked generally OK. (remember, once you use someone else's data, it becomes your problem!)     

I pulled all this in and tried to use specific code and packages that we've used in class as much as possible so you could see where the pieces came from.     

Without belaboring this too much, you can see in today's files where I have the raw data I imported and cleaned, and how I timmed out unwanted characteristics / elements, e.g. [Chorus]. 

---
# Steps: Data cleaning and pre-processing    
(see: data/swift_data_raw)  
Here is a snippet of what the raw structure was: `data &gt; albums &gt; 1989 &gt; song.txt`    

--
Here is what the raw txt file looked like: 

```r
strwrap(read_lines(here("..", "text-analysis-fundamentals-and-sentiment-analysis-and-tm", "data", "swift_data_raw", "Albums", "1989", "BlankSpace.txt")), 80)
##  [1] "237 ContributorsTranslationsTürkçeEspañolPortuguêsPolskiΕλληνικάFrançaisBlank"
##  [2] "Space Lyrics[Verse 1]"                                                        
##  [3] "Nice to meet you, where you been?"                                            
##  [4] "I could show you incredible things"                                           
##  [5] "Magic, madness, heaven, sin"                                                  
##  [6] "Saw you there and I thought"                                                  
##  [7] "\"Oh, my God, look at that face"                                              
##  [8] "You look like my next mistake"                                                
##  [9] "Love's a game, wanna play?\" Ayy"                                             
## [10] "New money, suit and tie"                                                      
## [11] "I can read you like a magazine"                                               
## [12] "Ain't it funny? Rumors fly"                                                   
## [13] "And I know you heard about me"                                                
## [14] "So, hey, let's be friends"                                                    
## [15] "I'm dying to see how this one ends"                                           
## [16] "Grab your passport and my hand"                                               
## [17] "I can make the bad guys good for a weekend"                                   
## [18] "[Chorus]"                                                                     
## [19] "So, it's gonna be forever"                                                    
## [20] "Or it's gonna go down in flames?"                                             
## [21] "You can tell me when it's over, mm"                                           
## [22] "If the high was worth the pain"                                               
## [23] "Got a long list of ex-lovers"                                                 
## [24] "They'll tell you I'm insane"                                                  
## [25] "'Cause you know I love the players"                                           
## [26] "And you love the game"                                                        
## [27] "'Cause we're young and we're reckless"                                        
## [28] "We'll take this way too far"                                                  
## [29] "It'll leave you breathless, mm"                                               
## [30] "Or with a nasty scar"                                                         
## [31] "Got a long list of ex-lovers"                                                 
## [32] "They'll tell you I'm insane"                                                  
## [33] "But I've got a blank space, baby"                                             
## [34] "And I'll write your name"                                                     
## [35] ""                                                                             
## [36] "[Verse 2]"                                                                    
## [37] "Cherry lips, crystal skies"                                                   
## [38] "I could show you incredible things"                                           
## [39] "Stolen kisses, pretty lies"                                                   
## [40] "You're the king, baby, I'm your queen"                                        
## [41] "Find out what you want"                                                       
## [42] "Be that girl for a month"                                                     
## [43] "Wait, the worst is yet to come, oh, no"                                       
## [44] "Screaming, crying, perfect storms"                                            
## [45] "I can make all the tables turn"                                               
## [46] "Rose garden filled with thorns"                                               
## [47] "Keep you second guessing, like"                                               
## [48] "\"Oh, my God, who is she?\""                                                  
## [49] "I get drunk on jealousy"                                                      
## [50] "But you'll come back each time you leave"                                     
## [51] "'Cause, darling, I'm a nightmare dressed like a daydream"                     
## [52] "You might also like[Chorus]"                                                  
## [53] "So, it's gonna be forever"                                                    
## [54] "Or it's gonna go down in flames?"                                             
## [55] "You can tell me when it's over, mm"                                           
## [56] "If the high was worth the pain"                                               
## [57] "Got a long list of ex-lovers"                                                 
## [58] "They'll tell you I'm insane"                                                  
## [59] "'Cause you know I love the players"                                           
## [60] "And you love the game"                                                        
## [61] "'Cause we're young and we're reckless (Oh)"                                   
## [62] "We'll take this way too far"                                                  
## [63] "It'll leave you breathless (Oh-oh), mm"                                       
## [64] "Or with a nasty scar"                                                         
## [65] "Got a long list of ex-lovers"                                                 
## [66] "They'll tell you I'm insane (Insane)"                                         
## [67] "But I've got a blank space, baby"                                             
## [68] "And I'll write your name"                                                     
## [69] ""                                                                             
## [70] "[Bridge]"                                                                     
## [71] "Boys only want love if it's torture"                                          
## [72] "Don't say I didn't, say I didn't warn ya"                                     
## [73] "Boys only want love if it's torture"                                          
## [74] "Don't say I didn't, say I didn't warn ya"                                     
## [75] ""                                                                             
## [76] "[Chorus]"                                                                     
## [77] "So, it's gonna be forever"                                                    
## [78] "Or it's gonna go down in flames?"                                             
## [79] "You can tell me when it's over (Over), mm"                                    
## [80] "If the high was worth the pain"                                               
## [81] "Got a long list of ex-lovers"                                                 
## [82] "They'll tell you I'm insane (I'm insane)"                                     
## [83] "'Cause you know I love the players"                                           
## [84] "And you love the game (And you love the game)"                                
## [85] "'Cause we're young and we're reckless (Yeah)"                                 
## [86] "We'll take this way too far (Ooh)"                                            
## [87] "It'll leave you breathless, mm"                                               
## [88] "Or with a nasty scar (With a nasty scar)"                                     
## [89] "Got a long list of ex-lovers"                                                 
## [90] "They'll tell you I'm insane"                                                  
## [91] "But I've got a blank space, baby"                                             
## [92] "And I'll write your name1KEmbed"
```
---
# Steps: Cleaning (see: data/swift_data_raw)
Obviously, there's a lot of work that was needed here. I did a rough clean -- for publication, I would probably do another pass or two and do some more spot checks. (I like to use a random number generator to select a row of my dataframe to verify that everything is good / looks OK). 

--

**Steps**:
1. Generate list of file paths (note I had to loop through albums to get songs). (HW05 was helpful for this)
1. Extract album title
    * Get title from path string
    * Add spaces back in where needed
1. Extract song title from file path
    * Get title from path string
    * Add spaces back in where needed
1. Read in data:
    * Read lines from path
    * Remove the top line
    * Get rid of any chunks about song structure
1. Merge data (Album, Song, Lyrics) and export as data frame



---
# Steps: Data transformation

* Remove stop words (sort of interesting, what do you do about songs like, 'the 1'?).  
* Perform analysis on entire corpus and by album:   
    * Frequency of words (histogram and wordcloud)
    * Sentiment of words (positive / negative)
    * Emotional score for text and albums
* Consider future steps: "eras" and "eras tour"???   


---
# Steps: Perform analysis on entire corpus vs albums
For this, we want to explore the most common words used by Taylor Swift overall. We can then consider how we might want to break things out in future anlaysis. *(Note, this was a rough clean, so we have some words that don't fully make sense in here).*
--
.panelset[
.panel[.panel-name[Overall Analysis]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_frequent_words.png" alt="Histogram of most frequent words in Taylor Swift songs" width="30%" /&gt;
&lt;p class="caption"&gt;Histogram of most frequent words in Taylor Swift songs&lt;/p&gt;
&lt;/div&gt;
]
.panel[.panel-name[Wordcloud]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_wordcloud.png" alt="Wordcloud of most frequent tokens in Taylor Swift songs" width="40%" /&gt;
&lt;p class="caption"&gt;Wordcloud of most frequent tokens in Taylor Swift songs&lt;/p&gt;
&lt;/div&gt;
]
.panel[.panel-name[Wordcloud: Pos/Neg]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_wordcloud_pos_neg.png" alt="Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics" width="40%" /&gt;
&lt;p class="caption"&gt;Most frequent Positive (dark gray) and Negative (light gray) tokens in Taylor Swift Lyrics&lt;/p&gt;
&lt;/div&gt;
]
.panel[.panel-name[Analysis by Album]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="50%" /&gt;
&lt;p class="caption"&gt;Histogram of most frequent words in Taylor Swift songs by album&lt;/p&gt;
&lt;/div&gt;
]
]

---
# Steps: Visualizations (Wordcloud)
Here, we can explore the word cloud generated from the text. THESE ARE NOT FOR ANALYSIS. YES THEY ARE COOL. NO THEY ARE NOT ANALYSIS!!!
--
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_wordcloud.png" alt="Word cloud of popular tokens" width="40%" /&gt;
&lt;p class="caption"&gt;Word cloud of popular tokens&lt;/p&gt;
&lt;/div&gt;

---
## Trajectory: Thinking about word use

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_frequent_words_album.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /&gt;
&lt;p class="caption"&gt;Histogram of most frequent words in Taylor Swift songs by album&lt;/p&gt;
&lt;/div&gt;
Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from 'girl' in her early albums to 'woman' in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. 



---
## Trajectory: Thinking about word use (tf-idf)    
When calculating tf-idf, we're looking for words that are more common relative to the rest of the corpus. We can think of this as an 'album signature' in our case. Here, we can see that we get a collection of different words than when we just look at the most frequent words. 

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_idf_words.png" alt="Histogram of most frequent words in Taylor Swift songs by album" width="70%" /&gt;
&lt;p class="caption"&gt;Histogram of most frequent words in Taylor Swift songs by album&lt;/p&gt;
&lt;/div&gt;
Across each album, we can get a sense of a trajectory: time and love seem to feature in quite frequently, while we see a shift from 'girl' in her early albums to 'woman' in later ones. We can dig into this a bit more deeply as we look at the sentiment of the words. 

---
# (reminder / review) LDA: TOPICS
LDA (Laten Dirichlet Allocation) is one method for fitting a topic model. It offers a means of *unsupervised* classification of a collection of documents. (I think of it as you dump a bunch of items into a pile and it sorts them for you based on patterns it finds...although the same item could appear in multiple piles). 

Small / simple example: suppose you have a list of a bunch of animals that you want grouped. You give it the following: dog, cat, parakeet, tiger, polar bear, lion, penguin. If you tell the model you want three topics, it might provide the following groups:

* Topic 1: Dog, cat, parakeet
* Topic 2: Parakeet, penguin, polar bear
* Topic 3: Cat, tiger, lion

--
It's up to you, the researcher, to determine what meaning or value lies within these topics / allocations. You may also determine how many topics you would like (more topics can mean a slower model). If you had said two topics, you might have gotten the following instead: 

* Topic 1: Dog, cat, parakeet
* Topic 2: Penguin, polar bear, tiger, lion

Notice that the 'sense' you make of the topics might be different in the two situations. 

---
# LDA: Two topic model
Let's start with a simple two-topic model (we'll get more complicated soon!)
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_frequent_words_topics.png" alt="Frequent words in a two-topic model" width="50%" /&gt;
&lt;p class="caption"&gt;Frequent words in a two-topic model&lt;/p&gt;
&lt;/div&gt;

--
We can think about what we might 'call' these topics and how we might want to explore this further. (Again, note this is unsupervised!)

---
# LDA: understanding the right number of topics
Let's try that again, but now with different numbers of topics. I have a visualization that is a little different from the text because I felt like it helped visualize the results better. We could do boxplots, but those were a bit messy for this particular dataset. 

--

.panelset[
.panel[.panel-name[Two topics]

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_2topics.png" alt="Text plot of songs, colored by albums (two topics)" width="40%" /&gt;
&lt;p class="caption"&gt;Text plot of songs, colored by albums (two topics)&lt;/p&gt;
&lt;/div&gt;
]
.panel[.panel-name[Three topics]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_3topics.png" alt="Text plot of songs, colored by albums (three topics)" width="40%" /&gt;
&lt;p class="caption"&gt;Text plot of songs, colored by albums (three topics)&lt;/p&gt;
&lt;/div&gt;
]
.panel[.panel-name[Ten topics!]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_10topics.png" alt="Text plot of songs, colored by albums (ten topics)" width="40%" /&gt;
&lt;p class="caption"&gt;Text plot of songs, colored by albums (ten topics)&lt;/p&gt;
&lt;/div&gt;
]
]

---

# Reflection: 


I think two topics makes sense here, of our options. However, I would be interested in pooling albums and reassessing to see. Alternatively, we might want to think about other ways to explore the meaning / distinctions. 


---

# Topic modeling: pros/cons

* Topic models **account for "multiplexity":** a given document is unlikely to fall precisely and fully into a single topic 

* Topic models **do not care about the order of words** “dog eats food" is the same as "food eats dog" 

* To determine the "right" number of topics: no fixed rule, it is a try-error process, ultimately **the researcher decides** (there are some metrics, such as perplexity and coherence score but are beyond our goals)

* Topics are **unlabeled:** they are just a bunch of words, it is up to the researcher to read, interpret, and label them

* Topic models are **no substitute for human interpretation of a text:** they are a way of making educated guesses about how words cohere into different latent themes by identifying patterns in the way they co-occur within documents. Many people are somewhat disappointed when they discover their model produces uninformative results

---

# LDAvis

LDAvis is a an interactive visualization of LDA model results

https://github.com/cpsievert/LDAvis


1. What is the meaning of each topic?
1. How prevalent is each topic?
1. How do the topics relate to each other?

---

class: inverse, middle

# Sentiment Analysis

---

# Sentiment Analysis

Use of NLP and programming to **study emotional states and subjective information in a text**. 

In practice sentiment analysis is usually applied:
* to determine the polarity of a text: whether a text is positive, negative, or neutral
* to detect specific feelings and emotions: angry, sad, happy, etc.
* examples: analyzing costumer feedback, classify movies review

Different from Topic Modeling, Sentiment Analysis it is usually supervised (e.g., needs a labeled input to compare our text to)

---

# Sentiment Analysis: our approach

Our approach to sentiment analysis (consistent with the book, Chapter 2): 

* consider the text a combination of its individual words, and 
* consider the sentiment content of the text as the sum of the sentiment content of the individual words

Notice: "This isn’t the only way to approach sentiment analysis, but it is an often-used approach, and an approach that naturally takes advantage of the tidy tool ecosystem."

---

# The `sentiments` datasets 

The tidytext package provides access to several sentiment lexicons:

+ **AFINN** from Finn Årup Nielsen (words classified with on a scale from -5 to +5)
+ **bing** from Bing Liu and collaborators (words classified into binary categories: negative and positive)
+ **nrc** from Saif Mohammad and Peter Turney (words classified in multiple categories)

See: https://www.tidytextmining.com/sentiment.html#the-sentiments-datasets

---

# The `sentiments` datasets

These dictionaries constitute our gold standard (e.g., our labeled sentiments): we use them to classify our texts.

Dictionary-based methods like these find the total sentiment of a piece of text by adding up the individual sentiment scores for each word in the text.

---

# Sentiment Analysis: Examples

**Examples from the book**: Chapter 2, and the three case-study chapters

**Another example (in today's class-materials)**: sentiment analysis of Harry Potter textual data. 

**Another example (in today's class-materials)**: sentiment analysis of Taylor Swift albums

---
class: middle, inverse, center

# Back to TS
![](https://media.giphy.com/media/u23zXEvNsIbfO/giphy.gif)


---
# Steps: Analysis -- Sentiment
Here, we can look at the sentiment within her work: specifically, what are the positive and negative words used, both overall and by album? 

--
.panelset[
.panel[.panel-name[Overall Analysis]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_sentiment.png" alt="Histogram of positive and negative sentiment in Taylor Swift songs" width="40%" /&gt;
&lt;p class="caption"&gt;Histogram of positive and negative sentiment in Taylor Swift songs&lt;/p&gt;
&lt;/div&gt;
]
.panel[.panel-name[Analysis by Album: Positive]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_positive_words_album.png" alt="Histogram of positive sentiment in Taylor Swift songs by album" width="40%" /&gt;
&lt;p class="caption"&gt;Histogram of positive sentiment in Taylor Swift songs by album&lt;/p&gt;
&lt;/div&gt;
]
.panel[.panel-name[Analysis by Album: Negative]
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_negative_words_album.png" alt="Histogram of negative sentiment in Taylor Swift songs by album" width="40%" /&gt;
&lt;p class="caption"&gt;Histogram of negative sentiment in Taylor Swift songs by album&lt;/p&gt;
&lt;/div&gt;
]
]


---
# Steps: Analysis (Negative Sentiment)
Again, here some expertise / background on Taylor Swift can be helpful to make sense of our analysis. We can see that her early work has less 'intense' (generally) language and the negative sentiment features words like, 'crazy,' 'sad,' and 'bad'. With Reputation, we see a shift (this makes sense given the album and its role in her discography). Here, we see words like 'hate' come in and, as we move into more recent albums, words like 'death,' 'shit,' 'kill.'  

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_negative_words_album.png" alt="Histogram of negative words by album" width="45%" /&gt;
&lt;p class="caption"&gt;Histogram of negative words by album&lt;/p&gt;
&lt;/div&gt;

# Steps: Analysis (Negative Sentiment)
With positive words, we see a lot of consistency ('like') and while there are some more 'innocent' words appearing with more frequency in earlier albums, we don't see as much change / evolution as we did with the negative words. If anything, the language has gotten more direct in the later work (which, particularly thinking about 1989 and Midnights, makes sense). 

--
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_positive_words_album.png" alt="Histogram of postive words used by album" width="45%" /&gt;
&lt;p class="caption"&gt;Histogram of postive words used by album&lt;/p&gt;
&lt;/div&gt;


---
# Steps: Visualizations

--
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../../img/ts_sentiment_album.png" alt="Emotional arc of TS albums" width="40%" /&gt;
&lt;p class="caption"&gt;Emotional arc of TS albums&lt;/p&gt;
&lt;/div&gt;

---
class: inverse, middle, center

![](https://media.giphy.com/media/ej1WNA2G75DfUai7NR/giphy.gif)

---
# Recap: 

* There are methods for analyzing text and getting a sense of the common ideas and topics that emerge
* Unsupervised (easier), supervised (need training data of some kind) can provide techniques to offer deeper insights
* Sentiment analysis looks at overall valence of words
* Lots of room for researcher to interpret: can be difficult to do well and needs some expertise to evaluate. 

---
# Acknowledgements

The content of these slides is derived in part from Sabrina Nardin and Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. I developed the Taylor Swift example using data from [Kaggle](https://www.kaggle.com/datasets/ishikajohari/taylor-swift-all-lyrics-30-albums/versions/12?resource=download) and building on code from [Text Mining in R](https://www.tidytextmining.com/). Any errors or oversights are mine alone.


---
class: middle, center, inverse

# THANK YOU ALL FOR A GREAT CLASS! I have genuinely enjoyed getting to know you and your work and hope you keep in touch regarding how you use R in the future!

We have one assignment remaining. Have a great rest of your summer!

    </textarea><style data-target=print-only>@media screen{.remark-slide-container{display:block}.remark-slide-scaler{box-shadow:none}}</style><script src=https://remarkjs.com/downloads/remark-latest.min.js></script><script>var slideshow=remark.create({highlightStyle:"magula",highlightLines:!0,highlightLanguage:"r",ratio:"16:9",countIncrementalSlides:!1});window.HTMLWidgets&&slideshow.on("afterShowSlide",function(){window.dispatchEvent(new Event("resize"))}),function(e){var t=e.createElement("style"),n=e.querySelector(".remark-slide-scaler");if(!n)return;t.type="text/css",t.innerHTML="@page {size: "+n.style.width+" "+n.style.height+"; }",e.head.appendChild(t)}(document),function(e){if(s=e.getElementsByClassName("remark-slides-area"),!s)return;for(var n,s,o,i=slideshow.getSlides(),a=s[0].children,t=1;t<i.length;t++)o=i[t],(o.properties.continued==="true"||o.properties.count==="false")&&(a[t-1].className+=" has-continuation");n=e.createElement("style"),n.type="text/css",n.innerHTML="@media print { .has-continuation { display: none; } }",e.head.appendChild(n)}(document),function(){var e=!1;slideshow.on("beforeShowSlide",function(){if(e)return;for(var n,o=document.styleSheets,s=0;s<o.length;s++){if(n=o[s].ownerNode,n.dataset.target!=="print-only")continue;n.parentNode.removeChild(n)}e=!0})}(),function(e){let t={};e.querySelectorAll(".remark-help-content table tr").forEach(e=>{const n=e.querySelector("td:nth-child(2)").innerText;e.querySelectorAll("td:first-child .key").forEach(e=>{const s=e.innerText;/^[a-z]$/.test(s)&&(t[s]=n)})}),e.body.setAttribute("data-at-shortcutkeys",JSON.stringify(t))}(document),function(){"use strict";var e,n,s,o,i,t=document.querySelectorAll(".remark-slides-area .remark-slide-container script");if(!t.length)return;for(e=0;e<t.length;e++){s=document.createElement("script"),i=document.createTextNode(t[e].textContent),s.appendChild(i);for(o=t[e].attributes,n=0;n<o.length;n++)s.setAttribute(o[n].name,o[n].value);t[e].parentElement.replaceChild(s,t[e])}}(),function(){for(var t=document.getElementsByTagName("a"),e=0;e<t.length;e++)/^(https?:)?\/\//.test(t[e].getAttribute("href"))&&(t[e].target="_blank")}(),function(e){const s=e.querySelectorAll(".remark-code-line-highlighted"),t=[],n=function(e,t=0){if(t>1)return null;const s=e.parentElement;return s.tagName==="PRE"?s:n(s,++t)};for(let o of s){let e=n(o);e&&!t.includes(e)&&t.push(e)}t.forEach(e=>e.classList.add("remark-code-has-line-highlighted"))}(document)</script><script>slideshow._releaseMath=function(e){var t,n,s,o=e.getElementsByTagName("code");for(s=0;s<o.length;){if(t=o[s],t.parentNode.tagName!=="PRE"&&t.childElementCount===0&&(n=t.textContent,/^\\\((.|\s)+\\\)$/.test(n)||/^\\\[(.|\s)+\\\]$/.test(n)||/^\$\$(.|\s)+\$\$$/.test(n)||/^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(n))){t.outerHTML=t.innerHTML;continue}s++}},slideshow._releaseMath(document)</script><script>(function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML",location.protocol!=="file:"&&/^https?:/.test(e.src)&&(e.src=e.src.replace(/^https?:/,"")),document.getElementsByTagName("head")[0].appendChild(e)})()</script></body></html></main><!doctype html><html><head><meta charset=utf-8><meta http-equiv=Content-Style-Type content="text/css"><title></title><meta name=Generator content="Cocoa HTML Writer"><meta name=CocoaVersion content="2299.7"><style type=text/css>p.p1{margin:0px;font:12px Times;-webkit-text-stroke:#000000}p.p2{margin:0px 0px 12px;font:12px Times;color:#0000e9;-webkit-text-stroke:#0000e9}li.li3{margin:0px;font:12px Times;-webkit-text-stroke:#000000;min-height:14px}span.s1{font-kerning:none}span.s2{font:10px Times;font-kerning:none}span.s3{text-decoration:underline;font-kerning:none}ul.ul1{list-style-type:disc}</style></head><body><p class=p1><span class=s1></span></p><p class=p1><span class=s1></span></p><p class=p1><span class=s1></span></p><p class=p1><span class=s1></span><span class=s2>© 2025 Jean Clipperton (materials adapted from Benjamin Soltoff and Sabrina Nardin) All Rights Reserved</span><span class=s1> <span class=Apple-converted-space> </span></span></p><p class=p1><span class=s1></span></p></body></html></div><script src=/js/main.min.8c87303b31e50afa09a774582c268712d6bb31cd6df1cdcb4573f32abeab7551.js integrity="sha256-jIcwOzHlCvoJp3RYLCaHEta7Mc1t8c3LRXPzKr6rdVE=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>