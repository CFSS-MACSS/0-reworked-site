<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>CFSS: Computing for the Social Sciences</title><meta name=description content='<!DOCTYPE html> Visualizing spatial data I class: center, middle, inverse, title-slide .title[ # Visualizing spatial data I ] .author[ ### INFO 5940 Cornell University ] --- ## Geospatial visualizations * Earliest form of information visualizations * Geospatial data visualizations * [Google Maps](https://www.google.com/maps) --- ## Not that Jon Snow <img src="https://media.giphy.com/media/3ohzdUi5U8LBb4GD4s/giphy.gif" width="80%" style="display: block; margin: auto;" /> --- ## Dr. John Snow <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Snow-cholera-map-1.jpg/2183px-Snow-cholera-map-1.jpg" width="50%" style="display: block; margin: auto;" /> .footnote[Source: [Wikipedia](https://en.wikipedia.org/wiki/John_Snow)] --- ## Designing modern maps * Depict spatial features * Incorporate additional attributes and information * Major features * Scale * Projection * Symbols --- ## Scale * Proportion between distances and sizes on a map and their actual distances and sizes on Earth * Small-scale map * Large-scale map --- ## Large-scale map <img src="index_files/figure-html/large-scale-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Small-scale map <img src="index_files/figure-html/small-scale-1.png" width="80%" style="display: block; margin: auto;" /> --- .pull-left[ ## Asgard <img src="../../../../../../../../img/asgard.jpeg" width="95%" style="display: block; margin: auto;" /> ] -- .pull-right[ ## Midgard <img src="../../../../../../../../img/midgard.png" width="95%" style="display: block; margin: auto;" /> ] --- ## Not flat <img src="https://images.theconversation.com/files/218823/original/file-20180514-100722-1yxg7ip.jpg" width="50%" style="display: block; margin: auto;" /> --- ## Projection * Process of taking a three-dimensional object and visualizing it on a two-dimensional surface * No 100% perfect method for this * Always introduces distortions -- * Properties of projection methods 1. Shape 1. Area 1. Angles 1. Distance 1. Direction --- <img src="index_files/figure-html/projections-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Symbols <img src="index_files/figure-html/bb-hydepark-stamen-1.png" width="80%" style="display: block; margin: auto;" /> --- class: inverse, middle # `ggmap` for raster maps --- ## `ggmap` - Package for drawing maps using `ggplot2` and **raster** map tiles - Static image files generated by mapping services - Focus on incorporating data into existing maps - Severely limits ability to change the appearance of the geographic map - Don&#39;t have to worry about the maps, just the data to go on top --- ## Bounding box .panelset[ .panel[.panel-name[Code] ```r nyc_bb <- c( * left = -74.263045, * bottom = 40.487652, * right = -73.675963, * top = 40.934743 ) nyc_stamen <- get_stamenmap( bbox = nyc_bb, zoom = 11 ) ggmap(nyc_stamen) ``` ] .panel[.panel-name[Plot] <img src="index_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /> ] ] --- ## Level of detail <img src="index_files/figure-html/bb-nyc-stamen-zoom-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Identifying bounding box > Use [bboxfinder.com](http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000) to determine the exact longitude/latitude coordinates for the bounding box you wish to obtain. --- ## Types of map tiles <img src="index_files/figure-html/stamen-maptype-1.png" width="80%" style="display: block; margin: auto;" /> --- <img src="https://media.giphy.com/media/oOK9AZGnf9b0c/giphy.gif" width="80%" style="display: block; margin: auto;" /> --- ## Import crime data * New York City open data portal * [Crime data from 2022](https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243) ```r crimes <- here("data", "nyc-crimes.csv") %>% read_csv() ``` ```r glimpse(crimes) ``` ``` ## Rows: 256,797 ## Columns: 7 ## $ cmplnt_num <chr> "247350382", "243724728", "246348713", "240025455", "2461… ## $ boro_nm <chr> "BROOKLYN", "QUEENS", "QUEENS", "BROOKLYN", "BRONX", "BRO… ## $ cmplnt_fr_dt <dttm> 1011-05-18 04:56:02, 1022-04-11 04:56:02, 1022-06-08 04:… ## $ law_cat_cd <chr> "MISDEMEANOR", "MISDEMEANOR", "MISDEMEANOR", "FELONY", "F… ## $ ofns_desc <chr> "CRIMINAL MISCHIEF & RELATED OF", "PETIT LARCENY", "PETIT… ## $ latitude <dbl> 40.66904, 40.77080, 40.68766, 40.65421, 40.83448, 40.6973… ## $ longitude <dbl> -73.90619, -73.81115, -73.83406, -73.95957, -73.85637, -7… ``` --- ## Plot high-level map of crime .panelset.sideways[ ```r nyc <- nyc_stamen *ggmap(nyc) ``` <img src="index_files/figure-html/import-nyc-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_point()` .panelset.sideways[ ```r ggmap(nyc) + * geom_point( * data = crimes, * mapping = aes( * x = longitude, * y = latitude * ) * ) ``` <img src="index_files/figure-html/plot-crime-point-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_point()` .panelset.sideways[ ```r ggmap(nyc) + geom_point( data = crimes, mapping = aes( x = longitude, y = latitude ), * size = .25, * alpha = .01 ) ``` <img src="index_files/figure-html/plot-crime-point-alpha-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + * geom_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude ) ) ``` <img src="index_files/figure-html/kde-contour-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `stat_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + * stat_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude, * fill = stat(level) ), * geom = "polygon" ) ``` <img src="index_files/figure-html/kde-fill-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `stat_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + stat_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude, fill = stat(level) ), * alpha = .2, * bins = 25, geom = "polygon" ) ``` <img src="index_files/figure-html/plot-crime-density-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Looking for variation .panelset.sideways[ ```r ggmap(nyc) + stat_density_2d( data = crimes %>% filter(ofns_desc %in% c( "DANGEROUS DRUGS", "GRAND LARCENY OF MOTOR VEHICLE", "ROBBERY", "VEHICLE AND TRAFFIC LAWS" )), aes( x = longitude, y = latitude, fill = stat(level) ), alpha = .4, bins = 10, geom = "polygon" ) + * facet_wrap(facets = vars(ofns_desc)) ``` <img src="index_files/figure-html/plot-crime-wday-1.png" width="100%" style="display: block; margin: auto;" /> ] --- ## Exercise using `ggmap` <img src="https://c.tenor.com/GopcJIF_Y98AAAAC/lost-kermit.gif" width="80%" style="display: block; margin: auto;" /> <div class="countdown" id="timer_6319fdf0" style="right:0;bottom:0;" data-warnwhen="0"> <code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>'><meta property="og:url" content="https://cfssmacss.netlify.app/slides/visualize-spatial-i/"><meta property="og:site_name" content="CFSS: Computing for the Social Sciences"><meta property="og:title" content="CFSS: Computing for the Social Sciences"><meta property="og:description" content='<!DOCTYPE html> Visualizing spatial data I class: center, middle, inverse, title-slide .title[ # Visualizing spatial data I ] .author[ ### INFO 5940 Cornell University ] --- ## Geospatial visualizations * Earliest form of information visualizations * Geospatial data visualizations * [Google Maps](https://www.google.com/maps) --- ## Not that Jon Snow <img src="https://media.giphy.com/media/3ohzdUi5U8LBb4GD4s/giphy.gif" width="80%" style="display: block; margin: auto;" /> --- ## Dr. John Snow <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Snow-cholera-map-1.jpg/2183px-Snow-cholera-map-1.jpg" width="50%" style="display: block; margin: auto;" /> .footnote[Source: [Wikipedia](https://en.wikipedia.org/wiki/John_Snow)] --- ## Designing modern maps * Depict spatial features * Incorporate additional attributes and information * Major features * Scale * Projection * Symbols --- ## Scale * Proportion between distances and sizes on a map and their actual distances and sizes on Earth * Small-scale map * Large-scale map --- ## Large-scale map <img src="index_files/figure-html/large-scale-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Small-scale map <img src="index_files/figure-html/small-scale-1.png" width="80%" style="display: block; margin: auto;" /> --- .pull-left[ ## Asgard <img src="../../../../../../../../img/asgard.jpeg" width="95%" style="display: block; margin: auto;" /> ] -- .pull-right[ ## Midgard <img src="../../../../../../../../img/midgard.png" width="95%" style="display: block; margin: auto;" /> ] --- ## Not flat <img src="https://images.theconversation.com/files/218823/original/file-20180514-100722-1yxg7ip.jpg" width="50%" style="display: block; margin: auto;" /> --- ## Projection * Process of taking a three-dimensional object and visualizing it on a two-dimensional surface * No 100% perfect method for this * Always introduces distortions -- * Properties of projection methods 1. Shape 1. Area 1. Angles 1. Distance 1. Direction --- <img src="index_files/figure-html/projections-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Symbols <img src="index_files/figure-html/bb-hydepark-stamen-1.png" width="80%" style="display: block; margin: auto;" /> --- class: inverse, middle # `ggmap` for raster maps --- ## `ggmap` - Package for drawing maps using `ggplot2` and **raster** map tiles - Static image files generated by mapping services - Focus on incorporating data into existing maps - Severely limits ability to change the appearance of the geographic map - Don&#39;t have to worry about the maps, just the data to go on top --- ## Bounding box .panelset[ .panel[.panel-name[Code] ```r nyc_bb <- c( * left = -74.263045, * bottom = 40.487652, * right = -73.675963, * top = 40.934743 ) nyc_stamen <- get_stamenmap( bbox = nyc_bb, zoom = 11 ) ggmap(nyc_stamen) ``` ] .panel[.panel-name[Plot] <img src="index_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /> ] ] --- ## Level of detail <img src="index_files/figure-html/bb-nyc-stamen-zoom-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Identifying bounding box > Use [bboxfinder.com](http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000) to determine the exact longitude/latitude coordinates for the bounding box you wish to obtain. --- ## Types of map tiles <img src="index_files/figure-html/stamen-maptype-1.png" width="80%" style="display: block; margin: auto;" /> --- <img src="https://media.giphy.com/media/oOK9AZGnf9b0c/giphy.gif" width="80%" style="display: block; margin: auto;" /> --- ## Import crime data * New York City open data portal * [Crime data from 2022](https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243) ```r crimes <- here("data", "nyc-crimes.csv") %>% read_csv() ``` ```r glimpse(crimes) ``` ``` ## Rows: 256,797 ## Columns: 7 ## $ cmplnt_num <chr> "247350382", "243724728", "246348713", "240025455", "2461… ## $ boro_nm <chr> "BROOKLYN", "QUEENS", "QUEENS", "BROOKLYN", "BRONX", "BRO… ## $ cmplnt_fr_dt <dttm> 1011-05-18 04:56:02, 1022-04-11 04:56:02, 1022-06-08 04:… ## $ law_cat_cd <chr> "MISDEMEANOR", "MISDEMEANOR", "MISDEMEANOR", "FELONY", "F… ## $ ofns_desc <chr> "CRIMINAL MISCHIEF & RELATED OF", "PETIT LARCENY", "PETIT… ## $ latitude <dbl> 40.66904, 40.77080, 40.68766, 40.65421, 40.83448, 40.6973… ## $ longitude <dbl> -73.90619, -73.81115, -73.83406, -73.95957, -73.85637, -7… ``` --- ## Plot high-level map of crime .panelset.sideways[ ```r nyc <- nyc_stamen *ggmap(nyc) ``` <img src="index_files/figure-html/import-nyc-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_point()` .panelset.sideways[ ```r ggmap(nyc) + * geom_point( * data = crimes, * mapping = aes( * x = longitude, * y = latitude * ) * ) ``` <img src="index_files/figure-html/plot-crime-point-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_point()` .panelset.sideways[ ```r ggmap(nyc) + geom_point( data = crimes, mapping = aes( x = longitude, y = latitude ), * size = .25, * alpha = .01 ) ``` <img src="index_files/figure-html/plot-crime-point-alpha-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + * geom_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude ) ) ``` <img src="index_files/figure-html/kde-contour-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `stat_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + * stat_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude, * fill = stat(level) ), * geom = "polygon" ) ``` <img src="index_files/figure-html/kde-fill-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `stat_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + stat_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude, fill = stat(level) ), * alpha = .2, * bins = 25, geom = "polygon" ) ``` <img src="index_files/figure-html/plot-crime-density-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Looking for variation .panelset.sideways[ ```r ggmap(nyc) + stat_density_2d( data = crimes %>% filter(ofns_desc %in% c( "DANGEROUS DRUGS", "GRAND LARCENY OF MOTOR VEHICLE", "ROBBERY", "VEHICLE AND TRAFFIC LAWS" )), aes( x = longitude, y = latitude, fill = stat(level) ), alpha = .4, bins = 10, geom = "polygon" ) + * facet_wrap(facets = vars(ofns_desc)) ``` <img src="index_files/figure-html/plot-crime-wday-1.png" width="100%" style="display: block; margin: auto;" /> ] --- ## Exercise using `ggmap` <img src="https://c.tenor.com/GopcJIF_Y98AAAAC/lost-kermit.gif" width="80%" style="display: block; margin: auto;" /> <div class="countdown" id="timer_6319fdf0" style="right:0;bottom:0;" data-warnwhen="0"> <code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="slides"><meta itemprop=name content="CFSS: Computing for the Social Sciences"><meta itemprop=description content='<!DOCTYPE html> Visualizing spatial data I class: center, middle, inverse, title-slide .title[ # Visualizing spatial data I ] .author[ ### INFO 5940 Cornell University ] --- ## Geospatial visualizations * Earliest form of information visualizations * Geospatial data visualizations * [Google Maps](https://www.google.com/maps) --- ## Not that Jon Snow <img src="https://media.giphy.com/media/3ohzdUi5U8LBb4GD4s/giphy.gif" width="80%" style="display: block; margin: auto;" /> --- ## Dr. John Snow <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Snow-cholera-map-1.jpg/2183px-Snow-cholera-map-1.jpg" width="50%" style="display: block; margin: auto;" /> .footnote[Source: [Wikipedia](https://en.wikipedia.org/wiki/John_Snow)] --- ## Designing modern maps * Depict spatial features * Incorporate additional attributes and information * Major features * Scale * Projection * Symbols --- ## Scale * Proportion between distances and sizes on a map and their actual distances and sizes on Earth * Small-scale map * Large-scale map --- ## Large-scale map <img src="index_files/figure-html/large-scale-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Small-scale map <img src="index_files/figure-html/small-scale-1.png" width="80%" style="display: block; margin: auto;" /> --- .pull-left[ ## Asgard <img src="../../../../../../../../img/asgard.jpeg" width="95%" style="display: block; margin: auto;" /> ] -- .pull-right[ ## Midgard <img src="../../../../../../../../img/midgard.png" width="95%" style="display: block; margin: auto;" /> ] --- ## Not flat <img src="https://images.theconversation.com/files/218823/original/file-20180514-100722-1yxg7ip.jpg" width="50%" style="display: block; margin: auto;" /> --- ## Projection * Process of taking a three-dimensional object and visualizing it on a two-dimensional surface * No 100% perfect method for this * Always introduces distortions -- * Properties of projection methods 1. Shape 1. Area 1. Angles 1. Distance 1. Direction --- <img src="index_files/figure-html/projections-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Symbols <img src="index_files/figure-html/bb-hydepark-stamen-1.png" width="80%" style="display: block; margin: auto;" /> --- class: inverse, middle # `ggmap` for raster maps --- ## `ggmap` - Package for drawing maps using `ggplot2` and **raster** map tiles - Static image files generated by mapping services - Focus on incorporating data into existing maps - Severely limits ability to change the appearance of the geographic map - Don&#39;t have to worry about the maps, just the data to go on top --- ## Bounding box .panelset[ .panel[.panel-name[Code] ```r nyc_bb <- c( * left = -74.263045, * bottom = 40.487652, * right = -73.675963, * top = 40.934743 ) nyc_stamen <- get_stamenmap( bbox = nyc_bb, zoom = 11 ) ggmap(nyc_stamen) ``` ] .panel[.panel-name[Plot] <img src="index_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /> ] ] --- ## Level of detail <img src="index_files/figure-html/bb-nyc-stamen-zoom-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Identifying bounding box > Use [bboxfinder.com](http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000) to determine the exact longitude/latitude coordinates for the bounding box you wish to obtain. --- ## Types of map tiles <img src="index_files/figure-html/stamen-maptype-1.png" width="80%" style="display: block; margin: auto;" /> --- <img src="https://media.giphy.com/media/oOK9AZGnf9b0c/giphy.gif" width="80%" style="display: block; margin: auto;" /> --- ## Import crime data * New York City open data portal * [Crime data from 2022](https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243) ```r crimes <- here("data", "nyc-crimes.csv") %>% read_csv() ``` ```r glimpse(crimes) ``` ``` ## Rows: 256,797 ## Columns: 7 ## $ cmplnt_num <chr> "247350382", "243724728", "246348713", "240025455", "2461… ## $ boro_nm <chr> "BROOKLYN", "QUEENS", "QUEENS", "BROOKLYN", "BRONX", "BRO… ## $ cmplnt_fr_dt <dttm> 1011-05-18 04:56:02, 1022-04-11 04:56:02, 1022-06-08 04:… ## $ law_cat_cd <chr> "MISDEMEANOR", "MISDEMEANOR", "MISDEMEANOR", "FELONY", "F… ## $ ofns_desc <chr> "CRIMINAL MISCHIEF & RELATED OF", "PETIT LARCENY", "PETIT… ## $ latitude <dbl> 40.66904, 40.77080, 40.68766, 40.65421, 40.83448, 40.6973… ## $ longitude <dbl> -73.90619, -73.81115, -73.83406, -73.95957, -73.85637, -7… ``` --- ## Plot high-level map of crime .panelset.sideways[ ```r nyc <- nyc_stamen *ggmap(nyc) ``` <img src="index_files/figure-html/import-nyc-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_point()` .panelset.sideways[ ```r ggmap(nyc) + * geom_point( * data = crimes, * mapping = aes( * x = longitude, * y = latitude * ) * ) ``` <img src="index_files/figure-html/plot-crime-point-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_point()` .panelset.sideways[ ```r ggmap(nyc) + geom_point( data = crimes, mapping = aes( x = longitude, y = latitude ), * size = .25, * alpha = .01 ) ``` <img src="index_files/figure-html/plot-crime-point-alpha-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + * geom_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude ) ) ``` <img src="index_files/figure-html/kde-contour-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `stat_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + * stat_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude, * fill = stat(level) ), * geom = "polygon" ) ``` <img src="index_files/figure-html/kde-fill-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `stat_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + stat_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude, fill = stat(level) ), * alpha = .2, * bins = 25, geom = "polygon" ) ``` <img src="index_files/figure-html/plot-crime-density-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Looking for variation .panelset.sideways[ ```r ggmap(nyc) + stat_density_2d( data = crimes %>% filter(ofns_desc %in% c( "DANGEROUS DRUGS", "GRAND LARCENY OF MOTOR VEHICLE", "ROBBERY", "VEHICLE AND TRAFFIC LAWS" )), aes( x = longitude, y = latitude, fill = stat(level) ), alpha = .4, bins = 10, geom = "polygon" ) + * facet_wrap(facets = vars(ofns_desc)) ``` <img src="index_files/figure-html/plot-crime-wday-1.png" width="100%" style="display: block; margin: auto;" /> ] --- ## Exercise using `ggmap` <img src="https://c.tenor.com/GopcJIF_Y98AAAAC/lost-kermit.gif" width="80%" style="display: block; margin: auto;" /> <div class="countdown" id="timer_6319fdf0" style="right:0;bottom:0;" data-warnwhen="0"> <code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>'><meta itemprop=wordCount content="847"><meta name=twitter:card content="summary"><meta name=twitter:title content="CFSS: Computing for the Social Sciences"><meta name=twitter:description content='<!DOCTYPE html> Visualizing spatial data I class: center, middle, inverse, title-slide .title[ # Visualizing spatial data I ] .author[ ### INFO 5940 Cornell University ] --- ## Geospatial visualizations * Earliest form of information visualizations * Geospatial data visualizations * [Google Maps](https://www.google.com/maps) --- ## Not that Jon Snow <img src="https://media.giphy.com/media/3ohzdUi5U8LBb4GD4s/giphy.gif" width="80%" style="display: block; margin: auto;" /> --- ## Dr. John Snow <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Snow-cholera-map-1.jpg/2183px-Snow-cholera-map-1.jpg" width="50%" style="display: block; margin: auto;" /> .footnote[Source: [Wikipedia](https://en.wikipedia.org/wiki/John_Snow)] --- ## Designing modern maps * Depict spatial features * Incorporate additional attributes and information * Major features * Scale * Projection * Symbols --- ## Scale * Proportion between distances and sizes on a map and their actual distances and sizes on Earth * Small-scale map * Large-scale map --- ## Large-scale map <img src="index_files/figure-html/large-scale-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Small-scale map <img src="index_files/figure-html/small-scale-1.png" width="80%" style="display: block; margin: auto;" /> --- .pull-left[ ## Asgard <img src="../../../../../../../../img/asgard.jpeg" width="95%" style="display: block; margin: auto;" /> ] -- .pull-right[ ## Midgard <img src="../../../../../../../../img/midgard.png" width="95%" style="display: block; margin: auto;" /> ] --- ## Not flat <img src="https://images.theconversation.com/files/218823/original/file-20180514-100722-1yxg7ip.jpg" width="50%" style="display: block; margin: auto;" /> --- ## Projection * Process of taking a three-dimensional object and visualizing it on a two-dimensional surface * No 100% perfect method for this * Always introduces distortions -- * Properties of projection methods 1. Shape 1. Area 1. Angles 1. Distance 1. Direction --- <img src="index_files/figure-html/projections-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Symbols <img src="index_files/figure-html/bb-hydepark-stamen-1.png" width="80%" style="display: block; margin: auto;" /> --- class: inverse, middle # `ggmap` for raster maps --- ## `ggmap` - Package for drawing maps using `ggplot2` and **raster** map tiles - Static image files generated by mapping services - Focus on incorporating data into existing maps - Severely limits ability to change the appearance of the geographic map - Don&#39;t have to worry about the maps, just the data to go on top --- ## Bounding box .panelset[ .panel[.panel-name[Code] ```r nyc_bb <- c( * left = -74.263045, * bottom = 40.487652, * right = -73.675963, * top = 40.934743 ) nyc_stamen <- get_stamenmap( bbox = nyc_bb, zoom = 11 ) ggmap(nyc_stamen) ``` ] .panel[.panel-name[Plot] <img src="index_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /> ] ] --- ## Level of detail <img src="index_files/figure-html/bb-nyc-stamen-zoom-1.png" width="80%" style="display: block; margin: auto;" /> --- ## Identifying bounding box > Use [bboxfinder.com](http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000) to determine the exact longitude/latitude coordinates for the bounding box you wish to obtain. --- ## Types of map tiles <img src="index_files/figure-html/stamen-maptype-1.png" width="80%" style="display: block; margin: auto;" /> --- <img src="https://media.giphy.com/media/oOK9AZGnf9b0c/giphy.gif" width="80%" style="display: block; margin: auto;" /> --- ## Import crime data * New York City open data portal * [Crime data from 2022](https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243) ```r crimes <- here("data", "nyc-crimes.csv") %>% read_csv() ``` ```r glimpse(crimes) ``` ``` ## Rows: 256,797 ## Columns: 7 ## $ cmplnt_num <chr> "247350382", "243724728", "246348713", "240025455", "2461… ## $ boro_nm <chr> "BROOKLYN", "QUEENS", "QUEENS", "BROOKLYN", "BRONX", "BRO… ## $ cmplnt_fr_dt <dttm> 1011-05-18 04:56:02, 1022-04-11 04:56:02, 1022-06-08 04:… ## $ law_cat_cd <chr> "MISDEMEANOR", "MISDEMEANOR", "MISDEMEANOR", "FELONY", "F… ## $ ofns_desc <chr> "CRIMINAL MISCHIEF & RELATED OF", "PETIT LARCENY", "PETIT… ## $ latitude <dbl> 40.66904, 40.77080, 40.68766, 40.65421, 40.83448, 40.6973… ## $ longitude <dbl> -73.90619, -73.81115, -73.83406, -73.95957, -73.85637, -7… ``` --- ## Plot high-level map of crime .panelset.sideways[ ```r nyc <- nyc_stamen *ggmap(nyc) ``` <img src="index_files/figure-html/import-nyc-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_point()` .panelset.sideways[ ```r ggmap(nyc) + * geom_point( * data = crimes, * mapping = aes( * x = longitude, * y = latitude * ) * ) ``` <img src="index_files/figure-html/plot-crime-point-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_point()` .panelset.sideways[ ```r ggmap(nyc) + geom_point( data = crimes, mapping = aes( x = longitude, y = latitude ), * size = .25, * alpha = .01 ) ``` <img src="index_files/figure-html/plot-crime-point-alpha-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `geom_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + * geom_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude ) ) ``` <img src="index_files/figure-html/kde-contour-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `stat_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + * stat_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude, * fill = stat(level) ), * geom = "polygon" ) ``` <img src="index_files/figure-html/kde-fill-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Using `stat_density_2d()` .panelset.sideways[ ```r ggmap(nyc) + stat_density_2d( data = crimes, mapping = aes( x = longitude, y = latitude, fill = stat(level) ), * alpha = .2, * bins = 25, geom = "polygon" ) ``` <img src="index_files/figure-html/plot-crime-density-1.png" width="80%" style="display: block; margin: auto;" /> ] --- ## Looking for variation .panelset.sideways[ ```r ggmap(nyc) + stat_density_2d( data = crimes %>% filter(ofns_desc %in% c( "DANGEROUS DRUGS", "GRAND LARCENY OF MOTOR VEHICLE", "ROBBERY", "VEHICLE AND TRAFFIC LAWS" )), aes( x = longitude, y = latitude, fill = stat(level) ), alpha = .4, bins = 10, geom = "polygon" ) + * facet_wrap(facets = vars(ofns_desc)) ``` <img src="index_files/figure-html/plot-crime-wday-1.png" width="100%" style="display: block; margin: auto;" /> ] --- ## Exercise using `ggmap` <img src="https://c.tenor.com/GopcJIF_Y98AAAAC/lost-kermit.gif" width="80%" style="display: block; margin: auto;" /> <div class="countdown" id="timer_6319fdf0" style="right:0;bottom:0;" data-warnwhen="0"> <code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>'><link rel=preload href=/scss/main.min.2bf6e9109f6f32347205312f445c5d7dea681b9fd1802a211b5786faf06a9b77.css as=style integrity="sha256-K/bpEJ9vMjRyBTEvRFxdfepoG5/RgCohG1eG+vBqm3c=" crossorigin=anonymous><link href=/scss/main.min.2bf6e9109f6f32347205312f445c5d7dea681b9fd1802a211b5786faf06a9b77.css rel=stylesheet integrity="sha256-K/bpEJ9vMjRyBTEvRFxdfepoG5/RgCohG1eG+vBqm3c=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>CFSS: Computing for the Social Sciences</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/syllabus/><span>Syllabus</span></a></li><li class=nav-item><a class=nav-link href=/schedule/><span>Schedule</span></a></li><li class=nav-item><a class=nav-link href=/assignments/><span>Assignments</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-default td-outer"><main role=main class=td-main><!doctype html><html lang xml:lang><head><title>Visualizing spatial data I</title><meta charset=utf-8><meta name=author content="INFO 5940   Cornell University"><script src=index_files/header-attrs/header-attrs.js></script><link href=index_files/panelset/panelset.css rel=stylesheet><script src=index_files/panelset/panelset.js></script><link href=index_files/countdown/countdown.css rel=stylesheet><script src=index_files/countdown/countdown.js></script><link rel=stylesheet href=xaringan-themer.css type=text/css></head><body><textarea id=source>
class: center, middle, inverse, title-slide

.title[
# Visualizing spatial data I
]
.author[
### INFO 5940 <br /> Cornell University
]

---






## Geospatial visualizations

* Earliest form of information visualizations
* Geospatial data visualizations
* [Google Maps](https://www.google.com/maps)

---

## Not that Jon Snow

&lt;img src="https://media.giphy.com/media/3ohzdUi5U8LBb4GD4s/giphy.gif" width="80%" style="display: block; margin: auto;" /&gt;

---

## Dr. John Snow

&lt;img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Snow-cholera-map-1.jpg/2183px-Snow-cholera-map-1.jpg" width="50%" style="display: block; margin: auto;" /&gt;

.footnote[Source: [Wikipedia](https://en.wikipedia.org/wiki/John_Snow)]

---

## Designing modern maps

* Depict spatial features
* Incorporate additional attributes and information
* Major features
    * Scale
    * Projection
    * Symbols

---

## Scale

* Proportion between distances and sizes on a map and their actual distances and sizes on Earth
* Small-scale map
* Large-scale map

---

## Large-scale map

&lt;img src="index_files/figure-html/large-scale-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Small-scale map

&lt;img src="index_files/figure-html/small-scale-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

.pull-left[

## Asgard


&lt;img src="../../../../../../../../img/asgard.jpeg" width="95%" style="display: block; margin: auto;" /&gt;

]

--

.pull-right[

## Midgard

&lt;img src="../../../../../../../../img/midgard.png" width="95%" style="display: block; margin: auto;" /&gt;

]

---

## Not flat

&lt;img src="https://images.theconversation.com/files/218823/original/file-20180514-100722-1yxg7ip.jpg" width="50%" style="display: block; margin: auto;" /&gt;

---

## Projection

* Process of taking a three-dimensional object and visualizing it on a two-dimensional surface
* No 100% perfect method for this
* Always introduces distortions

--


* Properties of projection methods
    1. Shape
    1. Area
    1. Angles
    1. Distance
    1. Direction

---



&lt;img src="index_files/figure-html/projections-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Symbols

&lt;img src="index_files/figure-html/bb-hydepark-stamen-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

class: inverse, middle

# `ggmap` for raster maps

---

## `ggmap`

- Package for drawing maps using `ggplot2` and **raster** map tiles
- Static image files generated by mapping services
- Focus on incorporating data into existing maps
- Severely limits ability to change the appearance of the geographic map
- Don't have to worry about the maps, just the data to go on top

---

## Bounding box



.panelset[
.panel[.panel-name[Code]

```r
nyc_bb &lt;- c(
* left = -74.263045,
* bottom = 40.487652,
* right = -73.675963,
* top = 40.934743
)

nyc_stamen &lt;- get_stamenmap(
  bbox = nyc_bb,
  zoom = 11
)
ggmap(nyc_stamen)
```



]

.panel[.panel-name[Plot]

&lt;img src="index_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /&gt;

]
]

---

## Level of detail

&lt;img src="index_files/figure-html/bb-nyc-stamen-zoom-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Identifying bounding box

&gt; Use [bboxfinder.com](http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000) to determine the exact longitude/latitude coordinates for the bounding box you wish to obtain.

---

## Types of map tiles

&lt;img src="index_files/figure-html/stamen-maptype-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

&lt;img src="https://media.giphy.com/media/oOK9AZGnf9b0c/giphy.gif" width="80%" style="display: block; margin: auto;" /&gt;

---

## Import crime data

* New York City open data portal
* [Crime data from 2022](https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243)




```r
crimes &lt;- here("data", "nyc-crimes.csv") %&gt;%
  read_csv()
```


```r
glimpse(crimes)
```

```
## Rows: 256,797
## Columns: 7
## $ cmplnt_num   &lt;chr&gt; "247350382", "243724728", "246348713", "240025455", "2461…
## $ boro_nm      &lt;chr&gt; "BROOKLYN", "QUEENS", "QUEENS", "BROOKLYN", "BRONX", "BRO…
## $ cmplnt_fr_dt &lt;dttm&gt; 1011-05-18 04:56:02, 1022-04-11 04:56:02, 1022-06-08 04:…
## $ law_cat_cd   &lt;chr&gt; "MISDEMEANOR", "MISDEMEANOR", "MISDEMEANOR", "FELONY", "F…
## $ ofns_desc    &lt;chr&gt; "CRIMINAL MISCHIEF &amp; RELATED OF", "PETIT LARCENY", "PETIT…
## $ latitude     &lt;dbl&gt; 40.66904, 40.77080, 40.68766, 40.65421, 40.83448, 40.6973…
## $ longitude    &lt;dbl&gt; -73.90619, -73.81115, -73.83406, -73.95957, -73.85637, -7…
```

---

## Plot high-level map of crime

.panelset.sideways[

```r
nyc &lt;- nyc_stamen
*ggmap(nyc)
```

&lt;img src="index_files/figure-html/import-nyc-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Using `geom_point()`

.panelset.sideways[

```r
ggmap(nyc) +
* geom_point(
*   data = crimes,
*   mapping = aes(
*     x = longitude,
*     y = latitude
*   )
* )
```

&lt;img src="index_files/figure-html/plot-crime-point-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Using `geom_point()`

.panelset.sideways[

```r
ggmap(nyc) +
  geom_point(
    data = crimes,
    mapping = aes(
      x = longitude,
      y = latitude
    ),
*   size = .25,
*   alpha = .01
  )
```

&lt;img src="index_files/figure-html/plot-crime-point-alpha-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Using `geom_density_2d()`

.panelset.sideways[

```r
ggmap(nyc) +
* geom_density_2d(
    data = crimes,
    mapping = aes(
      x = longitude,
      y = latitude
    )
  )
```

&lt;img src="index_files/figure-html/kde-contour-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Using `stat_density_2d()`

.panelset.sideways[

```r
ggmap(nyc) +
* stat_density_2d(
    data = crimes,
    mapping = aes(
      x = longitude,
      y = latitude,
*     fill = stat(level)
    ),
*   geom = "polygon"
  )
```

&lt;img src="index_files/figure-html/kde-fill-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Using `stat_density_2d()`

.panelset.sideways[

```r
ggmap(nyc) +
  stat_density_2d(
    data = crimes,
    mapping = aes(
      x = longitude,
      y = latitude,
      fill = stat(level)
    ),
*   alpha = .2,
*   bins = 25,
    geom = "polygon"
  )
```

&lt;img src="index_files/figure-html/plot-crime-density-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Looking for variation

.panelset.sideways[

```r
ggmap(nyc) +
  stat_density_2d(
    data = crimes %&gt;%
      filter(ofns_desc %in% c(
        "DANGEROUS DRUGS",
        "GRAND LARCENY OF MOTOR VEHICLE",
        "ROBBERY",
        "VEHICLE AND TRAFFIC LAWS"
      )),
    aes(
      x = longitude,
      y = latitude,
      fill = stat(level)
    ),
    alpha = .4,
    bins = 10,
    geom = "polygon"
  ) +
* facet_wrap(facets = vars(ofns_desc))
```

&lt;img src="index_files/figure-html/plot-crime-wday-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Exercise using `ggmap`

&lt;img src="https://c.tenor.com/GopcJIF_Y98AAAAC/lost-kermit.gif" width="80%" style="display: block; margin: auto;" /&gt;

<div class="countdown" id="timer_6319fdf0" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

class: middle, inverse

# Geofaceting

---



&lt;img src="index_files/figure-html/geofacet-state-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Daily US vaccine data by state



.small[

```r
us_state_vaccinations &lt;- read_csv(here::here("data", "us_state_vaccinations.csv"))
```


```r
glimpse(us_state_vaccinations)
```

```
## Rows: 38,052
## Columns: 16
## $ date                                &lt;date&gt; 2021-01-12, 2021-01-13, 2021-01-1…
## $ location                            &lt;chr&gt; "Alabama", "Alabama", "Alabama", "…
## $ total_vaccinations                  &lt;dbl&gt; 78134, 84040, 92300, 100567, NA, N…
## $ total_distributed                   &lt;dbl&gt; 377025, 378975, 435350, 444650, NA…
## $ people_vaccinated                   &lt;dbl&gt; 70861, 74792, 80480, 86956, NA, NA…
## $ people_fully_vaccinated_per_hundred &lt;dbl&gt; 0.15, 0.19, NA, 0.28, NA, NA, NA, …
## $ total_vaccinations_per_hundred      &lt;dbl&gt; 1.59, 1.71, 1.88, 2.05, NA, NA, NA…
## $ people_fully_vaccinated             &lt;dbl&gt; 7270, 9245, NA, 13488, NA, NA, NA,…
## $ people_vaccinated_per_hundred       &lt;dbl&gt; 1.45, 1.53, 1.64, 1.77, NA, NA, NA…
## $ distributed_per_hundred             &lt;dbl&gt; 7.69, 7.73, 8.88, 9.07, NA, NA, NA…
## $ daily_vaccinations_raw              &lt;dbl&gt; NA, 5906, 8260, 8267, NA, NA, NA, …
## $ daily_vaccinations                  &lt;dbl&gt; NA, 5906, 7083, 7478, 7498, 7509, …
## $ daily_vaccinations_per_million      &lt;dbl&gt; NA, 1205, 1445, 1525, 1529, 1531, …
## $ share_doses_used                    &lt;dbl&gt; 0.207, 0.222, 0.212, 0.226, NA, NA…
## $ total_boosters                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ total_boosters_per_hundred          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA…
```

]

.footnote[
Source: https://ourworldindata.org/us-states-vaccinations
]

---

## Facet by location

.panelset.sideways[
.panel[.panel-name[Code]

```r
ggplot(
  data = us_state_vaccinations,
  mapping = aes(x = date, y = people_fully_vaccinated_per_hundred)
) +
  geom_area() +
* facet_wrap(facets = vars(location))
```



]

.panel[.panel-name[Plot]

&lt;img src="index_files/figure-html/unnamed-chunk-15-1.png" width="95%" style="display: block; margin: auto;" /&gt;

]
]

---

## Data cleaning


```r
us_state_vaccinations &lt;- us_state_vaccinations %&gt;%
  mutate(location = if_else(location == "New York State", "New York", location)) %&gt;%
  filter(location %in% c(state.name, "District of Columbia"))
```

---

## Geofacet by state

Using `geofacet::facet_geo()`:

.panelset.sideways[
.panel[.panel-name[Code]

```r
ggplot( 
  data = us_state_vaccinations,
  mapping = aes(x = date, y = people_fully_vaccinated_per_hundred)
) +
  geom_area() +
* facet_geo(facets = vars(location)) +
  labs(
    x = NULL, y = NULL,
    title = "Covid-19 vaccination rate in the US",
    subtitle = "Daily number of people fully vaccinated, per hundred",
    caption = "Source: Our World in Data"
  )
```



]

.panel[.panel-name[Plot]

&lt;img src="index_files/figure-html/unnamed-chunk-17-1.png" width="95%" style="display: block; margin: auto;" /&gt;

]
]

---

## Geofacet by state, with improvements

.panelset.sideways[
.panel[.panel-name[Plot]
&lt;img src="index_files/figure-html/unnamed-chunk-18-1.png" width="95%" style="display: block; margin: auto;" /&gt;
]
.panel[.panel-name[Code]
.small[

```r
ggplot(us_state_vaccinations, aes(x = date, y = people_fully_vaccinated_per_hundred, group = location)) +
  geom_area() +
  facet_geo(facets = vars(location)) +
* scale_y_continuous(
*   limits = c(0, 100),
*   breaks = c(0, 50, 100),
*   minor_breaks = c(25, 75)
*   ) +
* scale_x_date(breaks = c(ymd("2021-01-01", "2021-07-01", "2022-01-01")), date_labels = "%b-%y") +
  labs(
    x = NULL, y = NULL,
    title = "Covid-19 vaccination rate in the US",
    subtitle = "Daily number of people fully vaccinated, per hundred",
    caption = "Source: Our World in Data"
  ) +
  theme(
*   strip.text.x = element_text(size = 7),
*   axis.text = element_text(size = 8),
    plot.title.position = "plot"
  )
```
]
]
]

---

## Bring in 2020 Presidential election results




```r
election_2020 &lt;- read_csv(here::here("data", "us-election-2020.csv"))
```


```r
election_2020
```

```
## # A tibble: 51 × 5
##    state                electoal_votes biden trump win       
##    &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
##  1 Alabama                           9     0     9 Republican
##  2 Alaska                            3     0     3 Republican
##  3 Arizona                          11    11     0 Democrat  
##  4 Arkansas                          6     0     6 Republican
##  5 California                       55    55     0 Democrat  
##  6 Colorado                          9     9     0 Democrat  
##  7 Connecticut                       7     7     0 Democrat  
##  8 Delaware                          3     3     0 Democrat  
##  9 District of Columbia              3     3     0 Democrat  
## 10 Florida                          29     0    29 Republican
## # … with 41 more rows
## # ℹ Use `print(n = ...)` to see more rows
```

---

## Geofacet by state, color by presidential election result

.tiny[
.panelset.sideways[
.panel[.panel-name[Code]

```r
us_state_vaccinations %&gt;%
  left_join(election_2020, by = c("location" = "state")) %&gt;%
  ggplot(mapping = aes(x = date, y = people_fully_vaccinated_per_hundred)) +
* geom_area(aes(fill = win)) +
  facet_geo(facets = vars(location)) +
* scale_y_continuous(limits = c(0, 100), breaks = c(0, 50, 100), minor_breaks = c(25, 75)) +
  scale_x_date(breaks = c(ymd("2021-01-01", "2021-07-01", "2022-01-01")), date_labels = "%b") +
* scale_fill_manual(values = c("#2D69A1", "#BD3028")) +
  labs(
    x = NULL, y = NULL,
    title = "Covid-19 vaccination rate in the US",
    subtitle = "Daily number of people fully vaccinated, per hundred",
    caption = "Source: Our World in Data",
    fill = "2020 Presidential\nElection"
  ) +
  theme(
    strip.text.x = element_text(size = 7),
    axis.text = element_text(size = 8),
    plot.title.position = "plot",
*   legend.position = c(0.93, 0.15),
*   legend.text = element_text(size = 9),
*   legend.title = element_text(size = 11),
*   legend.background = element_rect(color = "gray", size = 0.5)
  )
```



]

.panel[.panel-name[Plot]

&lt;img src="index_files/figure-html/unnamed-chunk-23-1.png" width="100%" style="display: block; margin: auto;" /&gt;

]
]
]
    </textarea><style data-target=print-only>@media screen{.remark-slide-container{display:block}.remark-slide-scaler{box-shadow:none}}</style><script src=https://remarkjs.com/downloads/remark-latest.min.js></script><script>var slideshow=remark.create({highlightStyle:"magula",highlightLines:!0,highlightLanguage:"r",ratio:"16:9",countIncrementalSlides:!1});window.HTMLWidgets&&slideshow.on("afterShowSlide",function(){window.dispatchEvent(new Event("resize"))}),function(e){var t=e.createElement("style"),n=e.querySelector(".remark-slide-scaler");if(!n)return;t.type="text/css",t.innerHTML="@page {size: "+n.style.width+" "+n.style.height+"; }",e.head.appendChild(t)}(document),function(e){if(s=e.getElementsByClassName("remark-slides-area"),!s)return;for(var n,s,o,i=slideshow.getSlides(),a=s[0].children,t=1;t<i.length;t++)o=i[t],(o.properties.continued==="true"||o.properties.count==="false")&&(a[t-1].className+=" has-continuation");n=e.createElement("style"),n.type="text/css",n.innerHTML="@media print { .has-continuation { display: none; } }",e.head.appendChild(n)}(document),function(){var e=!1;slideshow.on("beforeShowSlide",function(){if(e)return;for(var n,o=document.styleSheets,s=0;s<o.length;s++){if(n=o[s].ownerNode,n.dataset.target!=="print-only")continue;n.parentNode.removeChild(n)}e=!0})}(),function(e){let t={};e.querySelectorAll(".remark-help-content table tr").forEach(e=>{const n=e.querySelector("td:nth-child(2)").innerText;e.querySelectorAll("td:first-child .key").forEach(e=>{const s=e.innerText;/^[a-z]$/.test(s)&&(t[s]=n)})}),e.body.setAttribute("data-at-shortcutkeys",JSON.stringify(t))}(document),function(){"use strict";var e,n,s,o,i,t=document.querySelectorAll(".remark-slides-area .remark-slide-container script");if(!t.length)return;for(e=0;e<t.length;e++){s=document.createElement("script"),i=document.createTextNode(t[e].textContent),s.appendChild(i);for(o=t[e].attributes,n=0;n<o.length;n++)s.setAttribute(o[n].name,o[n].value);t[e].parentElement.replaceChild(s,t[e])}}(),function(){for(var t=document.getElementsByTagName("a"),e=0;e<t.length;e++)/^(https?:)?\/\//.test(t[e].getAttribute("href"))&&(t[e].target="_blank")}(),function(e){const s=e.querySelectorAll(".remark-code-line-highlighted"),t=[],n=function(e,t=0){if(t>1)return null;const s=e.parentElement;return s.tagName==="PRE"?s:n(s,++t)};for(let o of s){let e=n(o);e&&!t.includes(e)&&t.push(e)}t.forEach(e=>e.classList.add("remark-code-has-line-highlighted"))}(document)</script><script>slideshow._releaseMath=function(e){var t,n,s,o=e.getElementsByTagName("code");for(s=0;s<o.length;){if(t=o[s],t.parentNode.tagName!=="PRE"&&t.childElementCount===0&&(n=t.textContent,/^\\\((.|\s)+\\\)$/.test(n)||/^\\\[(.|\s)+\\\]$/.test(n)||/^\$\$(.|\s)+\$\$$/.test(n)||/^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(n))){t.outerHTML=t.innerHTML;continue}s++}},slideshow._releaseMath(document)</script><script>(function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML",location.protocol!=="file:"&&/^https?:/.test(e.src)&&(e.src=e.src.replace(/^https?:/,"")),document.getElementsByTagName("head")[0].appendChild(e)})()</script></body></html></main><!doctype html><html><head><meta charset=utf-8><meta http-equiv=Content-Style-Type content="text/css"><title></title><meta name=Generator content="Cocoa HTML Writer"><meta name=CocoaVersion content="2299.7"><style type=text/css>p.p1{margin:0px;font:12px Times;-webkit-text-stroke:#000000}p.p2{margin:0px 0px 12px;font:12px Times;color:#0000e9;-webkit-text-stroke:#0000e9}li.li3{margin:0px;font:12px Times;-webkit-text-stroke:#000000;min-height:14px}span.s1{font-kerning:none}span.s2{font:10px Times;font-kerning:none}span.s3{text-decoration:underline;font-kerning:none}ul.ul1{list-style-type:disc}</style></head><body><p class=p1><span class=s1></span></p><p class=p1><span class=s1></span></p><p class=p1><span class=s1></span></p><p class=p1><span class=s1></span><span class=s2>© 2025 Jean Clipperton (materials adapted from Benjamin Soltoff and Sabrina Nardin) All Rights Reserved</span><span class=s1> <span class=Apple-converted-space> </span></span></p><p class=p1><span class=s1></span></p></body></html></div><script src=/js/main.min.8c87303b31e50afa09a774582c268712d6bb31cd6df1cdcb4573f32abeab7551.js integrity="sha256-jIcwOzHlCvoJp3RYLCaHEta7Mc1t8c3LRXPzKr6rdVE=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>